{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/mollendorff-ai/forge/schema/forge-v1.0.0.json",
  "title": "Forge Financial Model Schema v1.0.0 - Scalar Only",
  "description": "JSON Schema for Forge v1.0.0 models (forge-demo). SCALAR VALUES ONLY - no arrays, no tables. Use v5.0.0 for enterprise features.",
  "type": "object",

  "required": ["_forge_version"],

  "properties": {
    "_forge_version": {
      "type": "string",
      "enum": ["1.0.0"],
      "description": "Forge model format version: 1.0.0 (scalar-only for forge-demo)"
    },
    "_name": {
      "type": "string",
      "description": "Document/workbook name - used for sheet naming in multi-document YAML"
    },
    "scenarios": {
      "$ref": "#/definitions/Scenarios",
      "description": "Named scenarios with variable overrides for what-if modeling"
    }
  },

  "additionalProperties": {
    "oneOf": [
      { "$ref": "#/definitions/ScalarGroup" },
      { "$ref": "#/definitions/Scalar" }
    ]
  },

  "definitions": {
    "ScalarGroup": {
      "title": "Scalar Group",
      "description": "Group of scalar values (maps to named cells in Excel)",
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/Scalar"
      },
      "examples": [
        {
          "assumptions": {
            "tax_rate": {
              "value": 0.25,
              "formula": null
            },
            "discount_rate": {
              "value": 0.10,
              "formula": null
            }
          }
        }
      ]
    },

    "Scalar": {
      "title": "Scalar Value",
      "description": "Single value with optional formula and rich metadata",
      "type": "object",
      "properties": {
        "value": {
          "oneOf": [
            { "type": "number" },
            { "type": "null" }
          ],
          "description": "Current calculated value (null if not yet calculated)"
        },
        "formula": {
          "oneOf": [
            {
              "type": "string",
              "pattern": "^=.+",
              "description": "Formula expression starting with ="
            },
            {
              "type": "null",
              "description": "No formula (manual input value)"
            }
          ]
        },
        "unit": { "type": "string", "description": "Unit of measurement (CAD, USD, %, count, days, ratio)" },
        "notes": { "type": "string", "description": "Human-readable explanation" },
        "source": { "type": "string", "description": "Where data came from (file:field or URL)" },
        "validation_status": {
          "type": "string",
          "enum": ["VALIDATED", "PROJECTED", "ESTIMATED"],
          "description": "Data validation status"
        },
        "last_updated": { "type": "string", "description": "ISO date of last update" }
      },
      "required": ["value"],
      "not": {
        "anyOf": [
          { "properties": { "value": { "type": "array" } } }
        ]
      },
      "examples": [
        {
          "value": 0.90,
          "formula": "=1 - platform_take_rate"
        },
        {
          "value": 0.10,
          "formula": null
        },
        {
          "value": 100000,
          "unit": "CAD",
          "notes": "Annual revenue target",
          "validation_status": "PROJECTED"
        }
      ]
    },

    "Scenarios": {
      "title": "Scenarios",
      "description": "Named scenarios with variable overrides for what-if modeling",
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/ScenarioOverrides"
      },
      "examples": [
        {
          "base": {
            "growth_rate": 0.05,
            "churn_rate": 0.02
          },
          "optimistic": {
            "growth_rate": 0.12,
            "churn_rate": 0.01
          },
          "pessimistic": {
            "growth_rate": 0.02,
            "churn_rate": 0.05
          }
        }
      ]
    },

    "ScenarioOverrides": {
      "title": "Scenario Overrides",
      "description": "Variable overrides for a single scenario",
      "type": "object",
      "additionalProperties": {
        "type": "number",
        "description": "Override value for a scalar variable"
      }
    }
  },

  "examples": [
    {
      "_forge_version": "1.0.0",
      "scenarios": {
        "base": { "growth_rate": 0.05 },
        "optimistic": { "growth_rate": 0.12 },
        "pessimistic": { "growth_rate": 0.02 }
      },
      "assumptions": {
        "tax_rate": {
          "value": 0.25,
          "formula": null
        },
        "growth_rate": {
          "value": 0.05,
          "formula": null
        }
      },
      "summary": {
        "total_revenue": {
          "value": 550000,
          "formula": "=monthly_revenue * 12"
        },
        "net_profit": {
          "value": 137500,
          "formula": "=total_revenue * (1 - tax_rate)"
        }
      }
    }
  ]
}
