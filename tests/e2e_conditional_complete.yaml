# E2E Conditional Function Complete Coverage
# v6.11.0 - ALL 8 conditional functions with REAL data tables
# FP&A MANDATE: 100% real test coverage, NO simulations

_forge_version: "1.0.0"

# ═════════════════════════════════════════════════════════════════════════════
# SALES DATA TABLE - Real data for conditional aggregation tests
# ═════════════════════════════════════════════════════════════════════════════
sales:
  region: ["North", "South", "East", "North", "South", "West", "East", "North", "West", "South"]
  amount: [1000, 500, 750, 2000, 1500, 300, 1200, 800, 2500, 600]
  status: ["Active", "Active", "Inactive", "Active", "Inactive", "Active", "Active", "Inactive", "Active", "Active"]
  quarter: [1, 1, 1, 2, 2, 2, 2, 3, 3, 3]
  score: [85, 92, 78, 95, 68, 88, 91, 82, 97, 75]

# ═════════════════════════════════════════════════════════════════════════════
# PRODUCT DATA TABLE - For additional test scenarios
# ═════════════════════════════════════════════════════════════════════════════
products:
  category: ["Electronics", "Furniture", "Electronics", "Clothing", "Furniture", "Electronics", "Clothing", "Furniture"]
  price: [1200, 450, 800, 150, 650, 2000, 95, 750]
  stock: [50, 20, 0, 100, 15, 30, 200, 5]
  rating: [4.5, 3.8, 4.2, 4.7, 3.5, 4.9, 4.1, 3.9]

assumptions:
  # ═══════════════════════════════════════════════════════════════════════════
  # SUMIF - Single criteria sum
  # SUMIF(range, criteria, sum_range)
  # ═══════════════════════════════════════════════════════════════════════════

  # Text criteria - exact match
  sumif_north:
    value: null
    formula: '=SUMIF(sales.region, "North", sales.amount)'
    # Expected: 1000 + 2000 + 800 = 3800

  sumif_active:
    value: null
    formula: '=SUMIF(sales.status, "Active", sales.amount)'
    # Expected: 1000 + 500 + 2000 + 300 + 1200 + 2500 + 600 = 8100

  sumif_electronics:
    value: null
    formula: '=SUMIF(products.category, "Electronics", products.price)'
    # Expected: 1200 + 800 + 2000 = 4000

  # Numeric criteria - greater than
  sumif_gt_1000:
    value: null
    formula: '=SUMIF(sales.amount, ">1000", sales.amount)'
    # Expected: 2000 + 1500 + 1200 + 2500 = 7200

  sumif_gt_500:
    value: null
    formula: '=SUMIF(products.price, ">500", products.price)'
    # Expected: 1200 + 800 + 650 + 2000 + 750 = 5400

  # Numeric criteria - less than
  sumif_lt_1000:
    value: null
    formula: '=SUMIF(sales.amount, "<1000", sales.amount)'
    # Expected: 500 + 750 + 300 + 800 + 600 = 2950

  sumif_lt_500:
    value: null
    formula: '=SUMIF(products.price, "<500", products.price)'
    # Expected: 450 + 150 + 95 = 695

  # Numeric criteria - greater than or equal
  sumif_gte_1000:
    value: null
    formula: '=SUMIF(sales.amount, ">=1000", sales.amount)'
    # Expected: 1000 + 2000 + 1500 + 1200 + 2500 = 8200

  # Numeric criteria - less than or equal
  sumif_lte_800:
    value: null
    formula: '=SUMIF(sales.amount, "<=800", sales.amount)'
    # Expected: 500 + 750 + 300 + 800 + 600 = 2950

  # Numeric criteria - not equal
  sumif_ne_1000:
    value: null
    formula: '=SUMIF(sales.amount, "<>1000", sales.amount)'
    # Expected: all except 1000 = 10150 - 1000 = 9150

  # Edge case - no matches
  sumif_no_match:
    value: null
    formula: '=SUMIF(sales.region, "Antarctica", sales.amount)'
    # Expected: 0

  # Edge case - all match
  sumif_all_match:
    value: null
    formula: '=SUMIF(sales.amount, ">0", sales.amount)'
    # Expected: sum of all amounts = 11150

  # ═══════════════════════════════════════════════════════════════════════════
  # COUNTIF - Single criteria count
  # COUNTIF(range, criteria)
  # ═══════════════════════════════════════════════════════════════════════════

  # Text criteria - exact match
  countif_north:
    value: null
    formula: '=COUNTIF(sales.region, "North")'
    # Expected: 3

  countif_active:
    value: null
    formula: '=COUNTIF(sales.status, "Active")'
    # Expected: 7

  countif_furniture:
    value: null
    formula: '=COUNTIF(products.category, "Furniture")'
    # Expected: 3

  # Numeric criteria - greater than
  countif_gt_1000:
    value: null
    formula: '=COUNTIF(sales.amount, ">1000")'
    # Expected: 4 (2000, 1500, 1200, 2500)

  countif_gt_90:
    value: null
    formula: '=COUNTIF(sales.score, ">90")'
    # Expected: 4 (92, 95, 91, 97)

  # Numeric criteria - less than
  countif_lt_1000:
    value: null
    formula: '=COUNTIF(sales.amount, "<1000")'
    # Expected: 5 (500, 750, 300, 800, 600)

  countif_lt_20:
    value: null
    formula: '=COUNTIF(products.stock, "<20")'
    # Expected: 2 (15, 5)

  # Numeric criteria - greater than or equal
  countif_gte_1000:
    value: null
    formula: '=COUNTIF(sales.amount, ">=1000")'
    # Expected: 5

  # Numeric criteria - less than or equal
  countif_lte_800:
    value: null
    formula: '=COUNTIF(sales.amount, "<=800")'
    # Expected: 5 (500, 750, 300, 800, 600)

  # Numeric criteria - equal
  countif_eq_2:
    value: null
    formula: '=COUNTIF(sales.quarter, "=2")'
    # Expected: 4

  # Numeric criteria - not equal
  countif_ne_active:
    value: null
    formula: '=COUNTIF(sales.status, "<>Active")'
    # Expected: 3

  # Edge case - no matches
  countif_no_match:
    value: null
    formula: '=COUNTIF(sales.region, "Mars")'
    # Expected: 0

  # Edge case - all match
  countif_all_match:
    value: null
    formula: '=COUNTIF(sales.amount, ">0")'
    # Expected: 10

  # ═══════════════════════════════════════════════════════════════════════════
  # AVERAGEIF - Single criteria average
  # AVERAGEIF(range, criteria, average_range)
  # ═══════════════════════════════════════════════════════════════════════════

  # Text criteria - exact match
  avgif_north:
    value: null
    formula: '=AVERAGEIF(sales.region, "North", sales.amount)'
    # Expected: (1000 + 2000 + 800) / 3 = 1266.666...

  avgif_south:
    value: null
    formula: '=AVERAGEIF(sales.region, "South", sales.amount)'
    # Expected: (500 + 1500 + 600) / 3 = 866.666...

  avgif_active:
    value: null
    formula: '=AVERAGEIF(sales.status, "Active", sales.amount)'
    # Expected: 8100 / 7 = 1157.142...

  avgif_electronics:
    value: null
    formula: '=AVERAGEIF(products.category, "Electronics", products.price)'
    # Expected: (1200 + 800 + 2000) / 3 = 1333.333...

  # Numeric criteria - greater than
  avgif_gt_1000:
    value: null
    formula: '=AVERAGEIF(sales.amount, ">1000", sales.amount)'
    # Expected: (2000 + 1500 + 1200 + 2500) / 4 = 1800

  avgif_gt_80:
    value: null
    formula: '=AVERAGEIF(sales.score, ">80", sales.score)'
    # Expected: (85 + 92 + 95 + 88 + 91 + 82 + 97) / 7 = 90

  # Numeric criteria - less than
  avgif_lt_1000:
    value: null
    formula: '=AVERAGEIF(sales.amount, "<1000", sales.amount)'
    # Expected: (500 + 750 + 300 + 800 + 600) / 5 = 590

  # Numeric criteria - greater than or equal
  avgif_gte_1000:
    value: null
    formula: '=AVERAGEIF(sales.amount, ">=1000", sales.amount)'
    # Expected: (1000 + 2000 + 1500 + 1200 + 2500) / 5 = 1640

  # Numeric criteria - less than or equal
  avgif_lte_100:
    value: null
    formula: '=AVERAGEIF(products.price, "<=100", products.price)'
    # Expected: 95 / 1 = 95

  # Edge case - single match
  avgif_single:
    value: null
    formula: '=AVERAGEIF(sales.region, "East", sales.amount)'
    # Expected: (750 + 1200) / 2 = 975

  # Edge case - all match
  avgif_all_match:
    value: null
    formula: '=AVERAGEIF(sales.amount, ">0", sales.amount)'
    # Expected: 11150 / 10 = 1115

  # ═══════════════════════════════════════════════════════════════════════════
  # SUMIFS - Multiple criteria sum
  # SUMIFS(sum_range, criteria_range1, criteria1, criteria_range2, criteria2, ...)
  # ═══════════════════════════════════════════════════════════════════════════

  # Two criteria - text matching
  sumifs_north_active:
    value: null
    formula: '=SUMIFS(sales.amount, sales.region, "North", sales.status, "Active")'
    # Expected: 1000 + 2000 = 3000

  sumifs_south_active:
    value: null
    formula: '=SUMIFS(sales.amount, sales.region, "South", sales.status, "Active")'
    # Expected: 500 + 600 = 1100

  # Two criteria - text and numeric
  sumifs_active_gt_1000:
    value: null
    formula: '=SUMIFS(sales.amount, sales.status, "Active", sales.amount, ">1000")'
    # Expected: 2000 + 1200 + 2500 = 5700

  sumifs_electronics_gt_1000:
    value: null
    formula: '=SUMIFS(products.price, products.category, "Electronics", products.price, ">1000")'
    # Expected: 1200 + 2000 = 3200

  # Two criteria - numeric range
  sumifs_amount_range:
    value: null
    formula: '=SUMIFS(sales.amount, sales.amount, ">=500", sales.amount, "<=1500")'
    # Expected: 1000 + 500 + 750 + 1500 + 1200 + 800 = 5750

  sumifs_price_range:
    value: null
    formula: '=SUMIFS(products.price, products.price, ">100", products.price, "<1000")'
    # Expected: 450 + 800 + 150 + 650 + 95 + 750 = 2895

  # Three criteria
  sumifs_three_cond:
    value: null
    formula: '=SUMIFS(sales.amount, sales.status, "Active", sales.quarter, ">=2", sales.amount, ">1000")'
    # Expected: 2000 + 1200 + 2500 = 5700

  sumifs_electronics_stock:
    value: null
    formula: '=SUMIFS(products.price, products.category, "Electronics", products.stock, ">0", products.price, ">500")'
    # Expected: 1200 + 800 + 2000 = 4000

  # Four criteria
  sumifs_four_cond:
    value: null
    formula: '=SUMIFS(sales.amount, sales.status, "Active", sales.region, "<>East", sales.quarter, ">=2", sales.amount, ">500")'
    # Expected: 2000 + 2500 = 4500

  # Edge case - no matches
  sumifs_no_match:
    value: null
    formula: '=SUMIFS(sales.amount, sales.region, "North", sales.status, "Inactive")'
    # Expected: 0

  # Edge case - all match
  sumifs_all_match:
    value: null
    formula: '=SUMIFS(sales.amount, sales.amount, ">0", sales.quarter, ">=1")'
    # Expected: 11150

  # ═══════════════════════════════════════════════════════════════════════════
  # COUNTIFS - Multiple criteria count
  # COUNTIFS(criteria_range1, criteria1, criteria_range2, criteria2, ...)
  # ═══════════════════════════════════════════════════════════════════════════

  # Two criteria - text matching
  countifs_north_active:
    value: null
    formula: '=COUNTIFS(sales.region, "North", sales.status, "Active")'
    # Expected: 2 (rows 1 and 4)

  countifs_south_inactive:
    value: null
    formula: '=COUNTIFS(sales.region, "South", sales.status, "Inactive")'
    # Expected: 1 (row 5)

  # Two criteria - text and numeric
  countifs_active_gt_1000:
    value: null
    formula: '=COUNTIFS(sales.status, "Active", sales.amount, ">1000")'
    # Expected: 3 (2000, 1200, 2500)

  countifs_furniture_low_stock:
    value: null
    formula: '=COUNTIFS(products.category, "Furniture", products.stock, "<20")'
    # Expected: 2 (15, 5)

  # Two criteria - numeric range
  countifs_amount_range:
    value: null
    formula: '=COUNTIFS(sales.amount, ">=500", sales.amount, "<=1500")'
    # Expected: 6 (1000, 500, 750, 1500, 1200, 800)

  countifs_score_range:
    value: null
    formula: '=COUNTIFS(sales.score, ">80", sales.score, "<95")'
    # Expected: 4 (85, 92, 88, 91, 82)

  # Three criteria
  countifs_three_cond:
    value: null
    formula: '=COUNTIFS(sales.status, "Active", sales.quarter, ">=2", sales.amount, ">1000")'
    # Expected: 3 (2000, 1200, 2500)

  countifs_electronics_instock:
    value: null
    formula: '=COUNTIFS(products.category, "Electronics", products.stock, ">0", products.price, ">500")'
    # Expected: 3 (1200, 800, 2000)

  # Four criteria
  countifs_four_cond:
    value: null
    formula: '=COUNTIFS(sales.status, "Active", sales.region, "<>East", sales.quarter, ">=2", sales.score, ">85")'
    # Expected: 3 (North Q2: 95, West Q3: 97, and check others)

  # Edge case - no matches
  countifs_no_match:
    value: null
    formula: '=COUNTIFS(sales.region, "North", sales.status, "Inactive", sales.quarter, "1")'
    # Expected: 0

  # Edge case - all match
  countifs_all_match:
    value: null
    formula: '=COUNTIFS(sales.amount, ">0", sales.quarter, ">=1", sales.score, ">0")'
    # Expected: 10

  # ═══════════════════════════════════════════════════════════════════════════
  # AVERAGEIFS - Multiple criteria average
  # AVERAGEIFS(average_range, criteria_range1, criteria1, criteria_range2, criteria2, ...)
  # ═══════════════════════════════════════════════════════════════════════════

  # Two criteria - text matching
  avgifs_north_active:
    value: null
    formula: '=AVERAGEIFS(sales.amount, sales.region, "North", sales.status, "Active")'
    # Expected: (1000 + 2000) / 2 = 1500

  avgifs_south_active:
    value: null
    formula: '=AVERAGEIFS(sales.amount, sales.region, "South", sales.status, "Active")'
    # Expected: (500 + 600) / 2 = 550

  # Two criteria - text and numeric
  avgifs_active_gt_1000:
    value: null
    formula: '=AVERAGEIFS(sales.amount, sales.status, "Active", sales.amount, ">1000")'
    # Expected: (2000 + 1200 + 2500) / 3 = 1900

  avgifs_electronics_instock:
    value: null
    formula: '=AVERAGEIFS(products.price, products.category, "Electronics", products.stock, ">0")'
    # Expected: (1200 + 800 + 2000) / 3 = 1333.333...

  # Two criteria - numeric range
  avgifs_amount_range:
    value: null
    formula: '=AVERAGEIFS(sales.amount, sales.amount, ">=500", sales.amount, "<=1500")'
    # Expected: (1000 + 500 + 750 + 1500 + 1200 + 800) / 6 = 958.333...

  avgifs_score_range:
    value: null
    formula: '=AVERAGEIFS(sales.score, sales.score, ">80", sales.score, "<95")'
    # Expected: (85 + 92 + 88 + 91 + 82) / 5 = 87.6

  # Three criteria
  avgifs_three_cond:
    value: null
    formula: '=AVERAGEIFS(sales.amount, sales.status, "Active", sales.quarter, ">=2", sales.amount, ">1000")'
    # Expected: (2000 + 1200 + 2500) / 3 = 1900

  avgifs_furniture_instock:
    value: null
    formula: '=AVERAGEIFS(products.price, products.category, "Furniture", products.stock, ">10", products.rating, ">3.5")'
    # Expected: (450 + 650 + 750) / 3 = 616.666...

  # Four criteria
  avgifs_four_cond:
    value: null
    formula: '=AVERAGEIFS(sales.amount, sales.status, "Active", sales.region, "<>East", sales.quarter, ">=2", sales.score, ">85")'
    # Expected: (2000 + 2500) / 2 = 2250

  # Edge case - single match
  avgifs_single_match:
    value: null
    formula: '=AVERAGEIFS(sales.amount, sales.region, "West", sales.quarter, "2")'
    # Expected: 300 / 1 = 300

  # Edge case - all match
  avgifs_all_match:
    value: null
    formula: '=AVERAGEIFS(sales.amount, sales.amount, ">0", sales.quarter, ">=1")'
    # Expected: 11150 / 10 = 1115

  # ═══════════════════════════════════════════════════════════════════════════
  # MAXIFS - Multiple criteria maximum
  # MAXIFS(max_range, criteria_range1, criteria1, criteria_range2, criteria2, ...)
  # ═══════════════════════════════════════════════════════════════════════════

  # Single criterion - text matching
  maxifs_north:
    value: null
    formula: '=MAXIFS(sales.amount, sales.region, "North")'
    # Expected: 2000

  maxifs_active:
    value: null
    formula: '=MAXIFS(sales.amount, sales.status, "Active")'
    # Expected: 2500

  maxifs_electronics:
    value: null
    formula: '=MAXIFS(products.price, products.category, "Electronics")'
    # Expected: 2000

  # Single criterion - numeric
  maxifs_gt_1000:
    value: null
    formula: '=MAXIFS(sales.amount, sales.amount, ">1000")'
    # Expected: 2500

  maxifs_q2:
    value: null
    formula: '=MAXIFS(sales.amount, sales.quarter, "2")'
    # Expected: 2000

  # Two criteria - text matching
  maxifs_north_active:
    value: null
    formula: '=MAXIFS(sales.amount, sales.region, "North", sales.status, "Active")'
    # Expected: 2000

  maxifs_south_active:
    value: null
    formula: '=MAXIFS(sales.amount, sales.region, "South", sales.status, "Active")'
    # Expected: 600

  # Two criteria - text and numeric
  maxifs_active_gt_1000:
    value: null
    formula: '=MAXIFS(sales.amount, sales.status, "Active", sales.amount, ">1000")'
    # Expected: 2500

  maxifs_electronics_instock:
    value: null
    formula: '=MAXIFS(products.price, products.category, "Electronics", products.stock, ">0")'
    # Expected: 2000

  # Two criteria - numeric range
  maxifs_amount_range:
    value: null
    formula: '=MAXIFS(sales.amount, sales.amount, ">=500", sales.amount, "<=1500")'
    # Expected: 1500

  maxifs_score_range:
    value: null
    formula: '=MAXIFS(sales.score, sales.score, ">80", sales.score, "<95")'
    # Expected: 92

  # Three criteria
  maxifs_three_cond:
    value: null
    formula: '=MAXIFS(sales.amount, sales.status, "Active", sales.quarter, ">=2", sales.score, ">85")'
    # Expected: 2500

  maxifs_furniture_instock:
    value: null
    formula: '=MAXIFS(products.price, products.category, "Furniture", products.stock, ">10", products.rating, ">3.5")'
    # Expected: 750

  # Edge case - single match
  maxifs_single_match:
    value: null
    formula: '=MAXIFS(sales.amount, sales.region, "West", sales.quarter, "2")'
    # Expected: 300

  # Edge case - all match
  maxifs_all_match:
    value: null
    formula: '=MAXIFS(sales.amount, sales.amount, ">0", sales.quarter, ">=1")'
    # Expected: 2500

  # ═══════════════════════════════════════════════════════════════════════════
  # MINIFS - Multiple criteria minimum
  # MINIFS(min_range, criteria_range1, criteria1, criteria_range2, criteria2, ...)
  # ═══════════════════════════════════════════════════════════════════════════

  # Single criterion - text matching
  minifs_north:
    value: null
    formula: '=MINIFS(sales.amount, sales.region, "North")'
    # Expected: 800

  minifs_active:
    value: null
    formula: '=MINIFS(sales.amount, sales.status, "Active")'
    # Expected: 300

  minifs_furniture:
    value: null
    formula: '=MINIFS(products.price, products.category, "Furniture")'
    # Expected: 450

  # Single criterion - numeric
  minifs_gt_1000:
    value: null
    formula: '=MINIFS(sales.amount, sales.amount, ">1000")'
    # Expected: 1200

  minifs_q3:
    value: null
    formula: '=MINIFS(sales.amount, sales.quarter, "3")'
    # Expected: 600

  # Two criteria - text matching
  minifs_north_active:
    value: null
    formula: '=MINIFS(sales.amount, sales.region, "North", sales.status, "Active")'
    # Expected: 1000

  minifs_south_active:
    value: null
    formula: '=MINIFS(sales.amount, sales.region, "South", sales.status, "Active")'
    # Expected: 500

  # Two criteria - text and numeric
  minifs_active_gt_1000:
    value: null
    formula: '=MINIFS(sales.amount, sales.status, "Active", sales.amount, ">1000")'
    # Expected: 1200

  minifs_electronics_instock:
    value: null
    formula: '=MINIFS(products.price, products.category, "Electronics", products.stock, ">0")'
    # Expected: 800

  # Two criteria - numeric range
  minifs_amount_range:
    value: null
    formula: '=MINIFS(sales.amount, sales.amount, ">=500", sales.amount, "<=1500")'
    # Expected: 500

  minifs_score_range:
    value: null
    formula: '=MINIFS(sales.score, sales.score, ">80", sales.score, "<95")'
    # Expected: 82

  # Three criteria
  minifs_three_cond:
    value: null
    formula: '=MINIFS(sales.amount, sales.status, "Active", sales.quarter, ">=2", sales.score, ">85")'
    # Expected: 1200

  minifs_furniture_instock:
    value: null
    formula: '=MINIFS(products.price, products.category, "Furniture", products.stock, ">10", products.rating, ">3.5")'
    # Expected: 450

  # Edge case - single match
  minifs_single_match:
    value: null
    formula: '=MINIFS(sales.amount, sales.region, "West", sales.quarter, "2")'
    # Expected: 300

  # Edge case - all match
  minifs_all_match:
    value: null
    formula: '=MINIFS(sales.amount, sales.amount, ">0", sales.quarter, ">=1")'
    # Expected: 300

  # ═══════════════════════════════════════════════════════════════════════════
  # EDGE CASES - Testing boundary conditions
  # ═══════════════════════════════════════════════════════════════════════════

  # Empty result sets
  edge_sumif_no_match:
    value: null
    formula: '=SUMIF(sales.region, "Atlantis", sales.amount)'
    # Expected: 0

  edge_countif_no_match:
    value: null
    formula: '=COUNTIF(sales.amount, ">10000")'
    # Expected: 0

  edge_sumifs_no_match:
    value: null
    formula: '=SUMIFS(sales.amount, sales.region, "North", sales.region, "South")'
    # Expected: 0 (impossible condition)

  edge_countifs_no_match:
    value: null
    formula: '=COUNTIFS(sales.amount, ">2000", sales.amount, "<1000")'
    # Expected: 0 (impossible condition)

  # Complex numeric criteria
  edge_sumif_boundary:
    value: null
    formula: '=SUMIF(sales.amount, ">=1000", sales.amount)'
    # Expected: includes 1000 exactly

  edge_countif_boundary:
    value: null
    formula: '=COUNTIF(sales.amount, "<=800")'
    # Expected: includes 800 exactly

  # Multiple same criteria
  edge_sumifs_redundant:
    value: null
    formula: '=SUMIFS(sales.amount, sales.status, "Active", sales.status, "Active")'
    # Expected: same as single criteria (8100)

  # String with wildcards potential (if supported)
  edge_countif_text_exact:
    value: null
    formula: '=COUNTIF(sales.region, "North")'
    # Expected: 3 (exact match only)
