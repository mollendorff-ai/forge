# Forge Roadmap
# Version: Cargo.toml | History: CHANGELOG.md | Config: project.yaml

# ═══════════════════════════════════════════════════════════════════════════════
# CURRENT - Codebase Cleanup & Documentation Consolidation
# ═══════════════════════════════════════════════════════════════════════════════

current:
  version: "10.0.0-alpha.7"
  status: released
  summary: "Codebase Cleanup - Delete orphans, consolidate docs, fix ADRs"

  # ─────────────────────────────────────────────────────────────────────────────
  # PHASE 1: DELETE - Remove orphaned/redundant files (29 files)
  # ─────────────────────────────────────────────────────────────────────────────
  phase1_delete:
    documentation:
      - "docs/INSTALLATION.md - Misnamed, contains only license info"
      - "docs/VERSION_HISTORY.md - 100% redundant with CHANGELOG.md"
      - "FP&A_TEST_COVERAGE_AUDIT.md - Outdated Dec 2025 audit, resolved in v7.2.0"

    adrs:
      - "docs/architecture/ADR-003-EDITOR-EXTENSIONS.md - Explicitly superseded by ADR-005"

    schemas:
      - "schema/forge-v1.0.schema.json.deprecated - Confusing name, redundant"
      - ".asimov/protocols.json - 100% duplicate of individual JSON files"

    scripts:
      - "bin/release.sh - Superseded by .github/workflows/release.yml"
      - "bin/session-end.sh - Manual developer utility, not needed in repo"

    examples:
      - "examples/check_columns.rs - Orphaned debug script"
      - "examples/check_export.rs - Orphaned debug script"
      - "examples/debug_parse.rs - Orphaned debug script"
      - "examples/test_formulas.rs - Orphaned debug script"

    test_data:
      - "test-data/test.yaml - Too simple, covered by budget.yaml"
      - "test-data/test_underscore.yaml - Too simple"
      - "test-data/test_platform.yaml - Redundant with budget.yaml"
      - "test-data/test_financial.yaml - Redundant"
      - "test-data/test_valid_updated.yaml - Minimal value"
      - "test-data/scalar_metadata_test.yaml - Too minimal"

  # ─────────────────────────────────────────────────────────────────────────────
  # PHASE 2: RENAME/MOVE - Fix organization (14 files)
  # ─────────────────────────────────────────────────────────────────────────────
  phase2_reorganize:
    adr_fixes:
      - "ADR-004-XLFORMULA-EQUIVALENCE.md → ADR-011-XLFORMULA-EQUIVALENCE.md (fix duplicate number)"
      - "ADR-024-SELF-UPDATE-REMOVAL.md → ADR-024-SELF-UPDATE.md (fix misleading title)"

    design_to_adr:
      - "docs/EXCEL_EXPORT_DESIGN.md → docs/architecture/ADR-033-EXCEL-EXPORT.md"
      - "docs/EXCEL_IMPORT_DESIGN.md → docs/architecture/ADR-034-EXCEL-IMPORT.md"
      - "docs/FORGE_V4_DESIGN.md → docs/architecture/ADR-035-RICH-METADATA.md"

    test_data_organize:
      - "Rename test-data/v1.0/ → test-data/examples/ (confusing name - files are v5.0.0)"
      - "Move v4_*.yaml files (6 files) to test-data/advanced/"
      - "Move quota_forecast.yaml to examples/"

    config:
      - "Move references.yaml to .asimov/ or delete"

  # ─────────────────────────────────────────────────────────────────────────────
  # PHASE 3: UPDATE - Fix content issues (14 files)
  # ─────────────────────────────────────────────────────────────────────────────
  phase3_update:
    adrs:
      - "ADR-012-FEATURE-FLAGS.md - Add note: pattern changed by ADR-025"
      - "ADR-015-FUNCTION-SCALAR-CLASSIFICATION.md - Fix header (says ADR-014)"
      - "ADR-030-GTM-LICENSING-STRATEGY.md - Note: license section superseded by ADR-031"
      - "docs/architecture/00-OVERVIEW.md - Update stats (60→173 functions)"

    schemas:
      - "schema/README.md - Fix broken reference, document both v1.0.0 and v5.0.0"

    config:
      - ".markdownlint.json - Remove duplicate keys (MD007, MD034, MD049)"

    source:
      - "Fix 3 clippy warnings in schema.rs and update.rs"
      - "Remove unused async-trait dependency from Cargo.toml"
      - "Review core/array_calculator/dates.rs dead code (594 lines)"

    changelog:
      - "Archive v7.x and earlier to docs/CHANGELOG_ARCHIVE.md (2567→600 lines)"

  # ─────────────────────────────────────────────────────────────────────────────
  # PHASE 4: CONSOLIDATE - Merge test files (11 → 2 files)
  # ─────────────────────────────────────────────────────────────────────────────
  phase4_consolidate:
    function_tests:
      - "Merge into test_all_functions.yaml:"
      - "  - test_formula_functions.yaml"
      - "  - test_math_text_functions.yaml"
      - "  - test_date_functions.yaml"
      - "  - test_array_functions.yaml"
      - "  - test_lookup_functions.yaml"
      - "  - test_conditional_aggregation.yaml"
      - "  - test_advanced_functions.yaml"
      - "  - test_forge_functions.yaml"

    if_tests:
      - "Merge into test_if_function.yaml:"
      - "  - if_compare_test.yaml"
      - "  - if_scalar_test.yaml"
      - "  - if_mult3_test.yaml"

# ─────────────────────────────────────────────────────────────────────────────
# COMPLETED - See CHANGELOG.md for full details
# ─────────────────────────────────────────────────────────────────────────────
completed:
  - version: "10.0.0-alpha.7"
    date: "2026-01-24"
    summary: "Codebase Cleanup - 29 deleted, 14 moved, 14 updated, 11 consolidated"
  - version: "10.0.0-alpha.6"
    date: "2026-01-24"
    summary: "Rebrand RoyalBit to Möllendorff Group Inc."
  - version: "10.0.0-alpha.5"
    date: "2026-01-03"
    summary: "Self-update command restored (ADR-024)"
  - version: "10.0.0-alpha.4"
    date: "2026-01-02"
    summary: "CLI Documentation: schema + examples commands"
  - version: "10.0.0-alpha.3"
    date: "2025-12-30"
    summary: "CI/CD, crates.io, Multi-Arch Releases"
  - version: "10.0.0-alpha.2"
    date: "2025-12-29"
    summary: "Elastic-2.0 License & Git History Cleanup"
  - version: "10.0.0-alpha.1"
    date: "2025-12-29"
    summary: "Documentation Overhaul for Public Release"

# ═══════════════════════════════════════════════════════════════════════════════
# GTM - Go-To-Market Strategy (Dec 29, 2025)
# ═══════════════════════════════════════════════════════════════════════════════

gtm:
  decision: "One product, Elastic-2.0 license, full features"
  rationale: |
    - Source Available (not FOSS) - code visible, auditable
    - Commercial production use requires license
    - NO automatic conversion to open source (perpetual control)
    - forge-demo DEPRECATED (one product, not two)
    - Shows full moat: MCP, Monte Carlo, FP&A functions
  adr_gtm: "ADR-030-GTM-LICENSING-STRATEGY.md"
  adr_license: "ADR-031-LICENSE-ELASTIC-2.0.md"
  analysis: "docs/MARKET_ANALYSIS.md"

  milestones:
    - version: "10.0.0-alpha"
      priority: CRITICAL
      status: completed
      date: "2025-12-30"
      summary: "Elastic-2.0 License + CI/CD + Public Release"
      releases:
        - "v10.0.0-alpha.0: Demo/enterprise split removed"
        - "v10.0.0-alpha.1: Documentation overhaul"
        - "v10.0.0-alpha.2: Elastic-2.0 license + git history cleanup"
        - "v10.0.0-alpha.3: CI/CD + crates.io + multi-arch releases"

    - version: "10.0.0"
      priority: HIGH
      status: pending
      summary: "Commercial Infrastructure"
      tasks:
        - "License key generation system"
        - "Customer portal (Stripe integration)"
        - "Usage tracking for Cloud MCP"
        - "Enterprise SSO/SAML support"

    - version: "10.1.0"
      priority: MEDIUM
      status: pending
      summary: "Cloud MCP Launch"
      tasks:
        - "Hosted MCP endpoint"
        - "Usage-based billing"
        - "Auto-scaling infrastructure"
        - "Global edge deployment"

# ═══════════════════════════════════════════════════════════════════════════════
# NEXT - Candidate milestones (pick one to start)
# ═══════════════════════════════════════════════════════════════════════════════

next:
  # ─────────────────────────────────────────────────────────────────────────────
  # COMPLETED - See CHANGELOG.md for history
  # ─────────────────────────────────────────────────────────────────────────────
  # v10.0.0-alpha.0 - Remove demo/enterprise split (2025-12-29)
  # v9.9.6  - ISERROR NA detection fix (2025-12-29)
  # v9.9.5  - Consolidate tests inline + Static musl builds
  # v9.9.4  - 100% Unit Test Coverage (+9 HLOOKUP tests)
  # v9.9.3  - E2E Test Fixes (FORGE-003, FORGE-004, FORGE-005, FORGE-TRIM)
  # v9.9.2  - Excel Export for Scalar Models (FORGE-EXPORT-001)
  # v9.9.1  - Monte Carlo Fix (FORGE-MC-001)
  # v9.8.0  - E2E Test Migration
  # ─────────────────────────────────────────────────────────────────────────────

  # v10.0.0-alpha.4 - CLI Documentation: schema + examples commands (2026-01-02)

  - version: "9.9.6"
    priority: HIGH
    status: pending
    summary: "100% Coverage Enforcement (ADR-004/ADR-006 compliance)"
    description: |
      Achieve 100% line coverage by:
      1. Marking untestable code with #[cfg(not(coverage))] (Rust nightly pattern)
      2. Adding tests for testable code gaps
      3. Documenting all exclusions in ADR-006
    tasks:
      - "Phase 1: Add #[cfg(not(coverage))] to untestable functions"
      - "  - api/server.rs: run_api_server, shutdown_signal"
      - "  - mcp/server.rs: run_mcp_server_sync"
      - "  - main.rs, bin/*.rs: all main() functions"
      - "  - cli/commands: prompt_*, open_in_editor, watch_file, serve"
      - "Phase 2: Add missing tests for testable code"
      - "  - cli/commands/export.rs: 63% → 100%"
      - "  - cli/commands/import.rs: 72% → 100%"
      - "  - api/handlers.rs: 76% → 100%"
      - "  - parser/mod.rs: 88% → 100%"
      - "Phase 3: Verify with cargo llvm-cov --cfg coverage --fail-under-lines 100"
    acceptance_criteria:
      - "make coverage passes (100% line coverage after exclusions)"
      - "All exclusions documented in ADR-006"
      - "Zero regression in existing tests"
    adr: "ADR-006-COVERAGE-EXCLUSIONS.md"

  - version: "10.0.0-beta.1"
    priority: HIGH
    status: pending
    summary: "MCP/API Feature Parity + OpenAPI"
    description: |
      Complete MCP and API server feature coverage. Currently:
      - CLI: 20 commands (all features)
      - MCP: 10 tools (missing 7 engines)
      - API: 5 endpoints (missing 15 features + no OpenAPI spec)
    tasks:
      - "Phase 1: Add missing API endpoints"
      - "  - POST /api/v1/simulate (Monte Carlo)"
      - "  - POST /api/v1/scenarios"
      - "  - POST /api/v1/decision-tree"
      - "  - POST /api/v1/real-options"
      - "  - POST /api/v1/tornado"
      - "  - POST /api/v1/bootstrap"
      - "  - POST /api/v1/bayesian"
      - "  - POST /api/v1/sensitivity"
      - "  - POST /api/v1/goal-seek"
      - "  - POST /api/v1/break-even"
      - "  - POST /api/v1/variance"
      - "  - POST /api/v1/compare"
      - "Phase 2: Add missing MCP tools"
      - "  - forge_simulate (Monte Carlo)"
      - "  - forge_scenarios"
      - "  - forge_decision_tree"
      - "  - forge_real_options"
      - "  - forge_tornado"
      - "  - forge_bootstrap"
      - "  - forge_bayesian"
      - "Phase 3: Generate OpenAPI 3.1 spec"
      - "  - Use utoipa or aide crate for auto-generation"
      - "  - Serve spec at GET /openapi.json"
      - "  - Serve Swagger UI at GET /docs (optional)"
      - "Phase 4: E2E tests in forge-e2e"
      - "  - Test all API endpoints against expected outputs"
      - "  - Test all MCP tools via JSON-RPC"
    acceptance_criteria:
      - "API: 17 endpoints (all CLI commands except watch/migrate/functions)"
      - "MCP: 17 tools (matching API)"
      - "OpenAPI 3.1 spec generated and served"
      - "E2E tests pass for all endpoints/tools"

  - version: "10.0.0-beta.2"
    priority: MEDIUM
    status: pending
    summary: "CLI Improvements: migrate + update commands"
    description: |
      Rename confusing 'upgrade' command and restore self-update functionality.
      - upgrade → migrate (schema migration v1.0.0 → v5.0.0)
      - update (new) - Self-update from GitHub releases

    tasks:
      - "Phase 1: Rename upgrade → migrate"
      - "  - Rename src/cli/commands/upgrade.rs → migrate.rs"
      - "  - Update CLI parser (clap) command name"
      - "  - Remove 'upgrade' entirely (no users yet)"
      - "  - Update all docs, help text, README"
      - "Phase 2: Restore update command (from ADR-024)"
      - "  - Fetch https://api.github.com/repos/mollendorff-ai/forge/releases/latest"
      - "  - Detect platform (linux-musl, darwin, windows)"
      - "  - Download correct asset (forge-{target}.tar.gz)"
      - "  - Verify SHA256 from checksums.txt"
      - "  - Extract and install to ~/bin/ (or current binary path)"
      - "  - Include forge-mcp and forge-server in update"
      - "  - forge update --check (check only, don't install)"
      - "Phase 3: Update ADR-024"
      - "  - Document restoration of update command"
      - "  - Note: Now valid because forge is public on GitHub"

    acceptance_criteria:
      - "forge migrate model.yaml works (schema migration)"
      - "forge update downloads and installs latest release"
      - "forge update --check shows version info without installing"
      - "All three binaries updated (forge, forge-mcp, forge-server)"

# ═══════════════════════════════════════════════════════════════════════════════
# BACKLOG - Future ideas (unscheduled)
# ═══════════════════════════════════════════════════════════════════════════════

backlog:
  # Simple one-liner descriptions (schema requires strings only)

  # ─────────────────────────────────────────────────────────────────────────────
  # GAME THEORY MODULE - For Kinship Protocol integration
  # ─────────────────────────────────────────────────────────────────────────────
  # Motivation: Kinship Protocol needs formal game theory proofs. Forge already
  # has decision trees, Bayesian networks, and Monte Carlo - game theory is a
  # natural extension. Enables YAML-native equilibrium analysis.
  #
  # Module structure (follows existing patterns):
  #   src/game_theory/
  #   ├── mod.rs           # Public exports
  #   ├── config.rs        # GameTheoryConfig, game definitions
  #   ├── engine.rs        # Core solver logic
  #   ├── equilibrium.rs   # Nash, correlated, evolutionary equilibria
  #   ├── repeated.rs      # Folk theorem, discount factors, cooperation thresholds
  #   ├── tournament.rs    # Axelrod-style IPD tournaments
  #   └── tests.rs         # Unit tests (~50-100 tests)
  #
  # YAML syntax example:
  #   game_theory:
  #     type: repeated_game
  #     players: [alice, bob]
  #     stages: 100
  #     discount_factor: 0.95
  #     payoff_matrix:
  #       CC: [3, 3]   # Mutual cooperation
  #       CD: [0, 5]   # Sucker's payoff
  #       DC: [5, 0]   # Temptation
  #       DD: [1, 1]   # Mutual defection
  #     strategies:
  #       alice: tit_for_tat
  #       bob: grim_trigger
  #     outputs:
  #       - nash_equilibria
  #       - cooperation_threshold    # c* where cooperation dominates
  #       - folk_theorem_check       # Is (C,C) sustainable?
  #       - evolutionary_stability   # ESS analysis
  #
  # CLI commands:
  #   forge game-theory model.yaml              # Analyze game
  #   forge game-theory model.yaml --tournament # Run Axelrod tournament
  #   forge game-theory model.yaml --folk       # Folk theorem verification
  #
  # Estimated effort: ~2,000 lines, 1-2 weeks
  # Dependencies: None new (statrs, rand_distr sufficient)
  # ─────────────────────────────────────────────────────────────────────────────

  - "v11.0.0: Game Theory Module - Nash equilibrium solver, IPD tournaments, Folk theorem verification"
  - "v11.0.0: Game Theory - Repeated games with discount factors and cooperation thresholds"
  - "v11.0.0: Game Theory - Evolutionary stability (ESS) and replicator dynamics"
  - "v11.0.0: Game Theory - Program equilibrium (source code inspection games)"
  - "v11.0.0: Game Theory - Axelrod tournament engine (TFT, Grim Trigger, Pavlov, etc.)"

  - "v9.9.7: Pedantic Linting - NO EXCEPTIONS (enable full pedantic clippy, fix all warnings)"
  - "v10.0.0: Performance - SIMD Vectorization (2-4x speedup on numeric-heavy workloads)"
  - "v10.1.0: Performance - Multi-threading with Rayon (near-linear scaling with core count)"
  - "v10.2.0: Performance - GPU Acceleration CUDA/OpenCL (10-100x for large simulations)"
  - "v10.3.0: Performance - Algorithmic Optimizations (flamegraph profiling, arena allocators)"
  - "v10.4.0: Crystal Analysis - N-Dimensional Fractal Visualization for DANEEL (ADR-028)"
  - "v9.9.0: Port edge cases from forge-e2e to inline Rust unit tests"
  - "v7.3.0: INCLUDE Feature - Complete E2E Testing & Roundtrip Validation"
  - "Find external FOSS tool to validate Forge-native functions"
  - "Enterprise licensing (when ready to leave CGI)"
  - "MCP server documentation"
  - "Performance benchmarks per function"
  - "FPGA acceleration for HFT (post-capitalization) - see ADR-026"

# ═══════════════════════════════════════════════════════════════════════════════
# BUGS - Active issues (none currently)
# ═══════════════════════════════════════════════════════════════════════════════

bugs:
  # ─────────────────────────────────────────────────────────────────────────────
  # NO ACTIVE BUGS - All bugs resolved (Jan 1, 2026)
  # ─────────────────────────────────────────────────────────────────────────────

  # ─────────────────────────────────────────────────────────────────────────────
  # FIXED/CLOSED BUGS
  # ─────────────────────────────────────────────────────────────────────────────
  # - FORGE-012 (fixed 2026-01-01) - Schema missing tornado/decision_tree/scenarios
  #   - Added Tornado, TornadoInput, DecisionTree, TreeNode, TreeBranch definitions
  #   - Added ScenariosCommand, ScenarioDefinition for command format
  #   - Parser now skips these special keys (handled by specific commands)
  # - FORGE-010 (INVALID in 9.9.6) - Could not reproduce, arrays load correctly
  # - FORGE-011 (fixed in 9.9.6) - ISERROR now detects NA() as error
  # - FORGE-MC-001 (fixed in 9.9.1) - Monte Carlo formula propagation
  # - FORGE-001 through FORGE-005 (fixed in 9.9.3) - E2E test failures
  # - FORGE-TRIM (fixed in 9.9.3) - TRIM internal spaces

# ═══════════════════════════════════════════════════════════════════════════════
# SUMMARY
# ═══════════════════════════════════════════════════════════════════════════════

summary:
  total_functions: 173
  categories: 15
  unit_tests: 1297
  e2e_tests: 836
  total_tests: 2133
  test_coverage: "100% (173/173 functions)"
  gaps: 0
  history: "See CHANGELOG.md"
  note: "v10.0.0-alpha.0: Removed demo/enterprise split. Single binary with all 173 functions."
