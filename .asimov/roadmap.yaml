# Forge Roadmap
# Version: Cargo.toml | History: CHANGELOG.md | Config: project.yaml

# ═══════════════════════════════════════════════════════════════════════════════
# COMPLETED
# ═══════════════════════════════════════════════════════════════════════════════

completed:
  - version: "5.15.0"
    date: "2025-12-08"
    summary: "Binary Split - forge-demo (36 functions) vs forge (enterprise)"

  - version: "5.16.0"
    date: "2025-12-08"
    summary: "GitHub Fresh Start - PUBLIC repo, GitHub Releases, website cleanup"

  - version: "5.17.0"
    date: "2025-12-09"
    summary: "Function Registry (ADR-013) + E2E test coverage"

  - version: "5.18.0"
    date: "2025-12-09"
    summary: "Documentation Polish - Enterprise Due Diligence Ready"

  - version: "5.19.0"
    date: "2025-12-09"
    summary: "Demo Function Expansion - 49 functions (add 7 math + 6 trig)"

  - version: "5.19.1"
    date: "2025-12-09"
    summary: "v1.0.0 Schema Bug Fix - String literals with letters"

  - version: "6.0.0"
    date: "2025-12-09"
    summary: "Comprehensive Function Testing & Validation (PARTIAL)"
    note: "Started category testing - 72/159 functions covered (45%)"
    stats:
      unit_tests: 1175
      e2e_tests: 38
      functions_covered: 72
      functions_total: 159
      coverage_percent: 45

  - version: "6.1.0"
    date: "2025-12-09"
    summary: "Math Functions - 100% E2E Coverage (20 functions)"
    deliverables:
      - "tests/e2e_math_complete.yaml - 90 scalars"
      - "tests/e2e_math_edge_cases.yaml - 79 scalars"

  - version: "6.2.0"
    date: "2025-12-09"
    summary: "Date Functions - 100% E2E Coverage (21 functions)"
    deliverables:
      - "tests/e2e_date_complete.yaml - 47 scalars"

  - version: "6.3.0"
    date: "2025-12-09"
    summary: "Text Functions - 100% E2E Coverage (15 functions)"
    deliverables:
      - "tests/e2e_text_complete.yaml - 18 scalars"

  - version: "6.4.0"
    date: "2025-12-09"
    summary: "Aggregation Functions - 100% E2E Coverage (14 functions)"
    deliverables:
      - "tests/e2e_aggregation_complete.yaml - 32 scalars"

  - version: "6.5.0"
    date: "2025-12-09"
    summary: "Lookup Functions - 100% E2E Coverage (13 functions)"
    deliverables:
      - "tests/e2e_lookup_complete.yaml - 17 scalars"

  - version: "6.6.0"
    date: "2025-12-09"
    summary: "Information Functions - 100% E2E Coverage (13 functions)"
    deliverables:
      - "tests/e2e_info_complete.yaml - 23 scalars"

  - version: "6.7.0"
    date: "2025-12-09"
    summary: "Financial Functions - 100% E2E Coverage (13 functions)"
    deliverables:
      - "tests/e2e_financial_complete.yaml - 23 scalars"

  - version: "6.8.0"
    date: "2025-12-09"
    summary: "Trigonometric Functions - 100% E2E Coverage (9 functions)"
    deliverables:
      - "tests/e2e_trig_complete.yaml - 31 scalars"

  - version: "6.9.0"
    date: "2025-12-09"
    summary: "Logical Functions - 100% E2E Coverage (9 functions)"
    deliverables:
      - "tests/e2e_logical_complete.yaml - 33 scalars"

  - version: "6.10.0"
    date: "2025-12-09"
    summary: "Statistical Functions - 100% E2E Coverage (8 functions)"
    deliverables:
      - "tests/e2e_statistical_complete.yaml - 14 scalars"

  - version: "6.11.0"
    date: "2025-12-09"
    summary: "Conditional Functions - 100% E2E Coverage (8 functions)"
    deliverables:
      - "tests/e2e_conditional_complete.yaml - 18 scalars"

  - version: "6.12.0"
    date: "2025-12-09"
    summary: "Forge Native Functions - 100% E2E Coverage (8 functions)"
    deliverables:
      - "tests/e2e_forge_complete.yaml - 17 scalars"

  - version: "6.13.0"
    date: "2025-12-09"
    summary: "Array Functions - 100% E2E Coverage (5 functions)"
    deliverables:
      - "tests/e2e_array_complete.yaml - 7 scalars"

  - version: "6.14.0"
    date: "2025-12-09"
    summary: "Advanced Functions - 100% E2E Coverage (3 functions)"
    deliverables:
      - "tests/e2e_advanced_complete.yaml - 9 scalars"

  - version: "6.15.0"
    date: "2025-12-09"
    summary: "Import/Export Roundtrip - Complete Validation"
    deliverables:
      - "tests/e2e_roundtrip_complete.yaml - 72 scalars covering all categories"
      - "All 16 E2E YAML files validated (459 total scalars)"

  - version: "7.0.1"
    date: "2025-12-09"
    summary: "FAKE TEST REMEDIATION - Real Test Coverage Restored"
    note: "Discovered 71% fake tests, fixed with table-based real function calls"

  - version: "7.0.2"
    date: "2025-12-09"
    summary: "FP&A ACCURACY HOTFIX - 6 Fake Tests Fixed with REAL Function Calls"
    deliverables:
      - "IRR: =ROUND(IRR(irr_cash_flows.values) * 100, 2) - REAL"
      - "MIRR: =ROUND(MIRR(mirr_cash_flows.values, 0.10, 0.12) * 100, 2) - REAL"
      - "XNPV: =ROUND(XNPV(0.09, xnpv_basic_data.values, xnpv_basic_data.dates), 2) - REAL"
      - "XIRR: =ROUND(XIRR(xirr_basic_data.values, xirr_basic_data.dates) * 100, 2) - REAL"
      - "LAMBDA: =LAMBDA(x, x*x)(5) - REAL"
      - "LET: =LET(x, 10, y, 5, x*x+y) - REAL"
    stats:
      unit_tests: 1777
      e2e_yaml_files: 15
      e2e_formulas: 689
      fake_tests_fixed: 6

  - version: "7.1.0"
    date: "2025-12-10"
    summary: "100% Real Test Coverage - 7-Agent Parallel Execution"
    deliverables:
      - "7 parallel agents covering all 159 functions"
      - "1320 unit tests passed"
      - "49 roundtrip tests passed (8 needed formula_translator fix)"

  - version: "7.1.1"
    date: "2025-12-10"
    summary: "XLSX Roundtrip 100% - Formula Translator Fix + Test Modules"
    deliverables:
      - "Fixed formula_translator.rs - general pattern for table.column refs"
      - "Split e2e_gnumeric_tests.rs into tests/roundtrip/ modules"
      - "57 roundtrip tests passing, 0 failing"
      - "1208 tests passing in cargo test"

# ═══════════════════════════════════════════════════════════════════════════════
# CURRENT - v8.0.0 Monte Carlo Simulation
# ═══════════════════════════════════════════════════════════════════════════════

current:
  version: "8.1.0"
  priority: CRITICAL
  status: completed
  completed: "2025-12-14"
  summary: "Monte Carlo Validation & Integration"
  deliverables:
    - "[DONE] Demo gating: Error on monte_carlo in v1.0.0 schema"
    - "[DONE] Output evaluation: Wire run_with_evaluator() to Forge array calculator"
    - "[DONE] E2E tests: tests/monte_carlo_e2e.rs with 24 comprehensive tests"
    - "[DONE] Python validator: tests/scripts/validate_mc.py (scipy/numpy)"
    - "[DONE] Excel export: --output results.xlsx with Summary, Histograms, Samples sheets"
  notes: |
    v8.0.0 core infrastructure COMPLETE (2025-12-13):
    - 6 distributions, LHS sampling, correlation, sensitivity
    - 58 unit tests passing
    v8.1.0 validation and integration COMPLETE (2025-12-14):
    - 24 E2E tests covering all distributions and sampling methods
    - Python validator for scipy/numpy validation
    - Demo gating prevents config confusion
    - Excel export with 4 sheets

# ═══════════════════════════════════════════════════════════════════════════════
# COMPLETED - v7.2.0 - TEST INTEGRITY (needs retest after schema/deps)
# ═══════════════════════════════════════════════════════════════════════════════

v7_2_0_completed:
  version: "7.2.0"
  priority: CRITICAL
  status: completed_retest_pending
  summary: "100% TEST INTEGRITY - Zero Fake Tests, Zero Weak Assertions, 100% Edge Cases"
  completed: "2025-12-10"
  retest_after: ["7.2.2", "7.2.3"]

  # ═══════════════════════════════════════════════════════════════════════════
  # GLOBAL MANDATE - APPLIES TO ALL AGENTS
  # ═══════════════════════════════════════════════════════════════════════════

  mandate: |
    ╔═══════════════════════════════════════════════════════════════════════════╗
    ║                    FP&A TOOL - 100% COVERAGE MANDATORY                    ║
    ╠═══════════════════════════════════════════════════════════════════════════╣
    ║  THIS IS A FINANCIAL PLANNING & ANALYSIS TOOL.                            ║
    ║  FINANCIAL CALCULATIONS MUST BE EXACT. NO EXCEPTIONS.                     ║
    ║                                                                           ║
    ║  RULES FOR EVERY AGENT:                                                   ║
    ║  1. 100% COVERAGE - Every function, every edge case, every error path     ║
    ║  2. NO SKIP - Do not skip tests, do not ignore functions                  ║
    ║  3. NO FAKE - No hardcoded values, no simulated results                   ║
    ║  4. NO CHEATING - No assert!(true), no is_ok()||is_err(), no let _ =     ║
    ║  5. REAL VERIFICATION - Every test must verify actual calculated values   ║
    ║  6. ROUNDTRIP VALIDATION - Gnumeric must confirm accuracy                ║
    ║                                                                           ║
    ║  IF YOU CANNOT TEST A FUNCTION: REPORT IT, DO NOT FAKE IT                 ║
    ╚═══════════════════════════════════════════════════════════════════════════╝

  audit_findings:
    date: "2025-12-10"
    current_score: "8.5/10"
    target_score: "10/10"
    unit_tests: "1,305 total (87% real, 13% weak → must be 100% real)"
    e2e_yaml: "1,231 formulas (99.92% real → must be 100% real)"
    roundtrip: "59 tests (54 enabled, 5 ignored → must be 100% enabled or documented)"
    edge_cases: "7.2/10 → must be 10/10"

  # ═══════════════════════════════════════════════════════════════════════════
  # PHASE 1: FIX ALL FAKE/WEAK TESTS (6 PARALLEL AGENTS)
  # ═══════════════════════════════════════════════════════════════════════════

  phase_1_fix_weak_tests:
    description: "Eliminate ALL weak assertions and fake tests"

    agent_1_core_tests:
      status: pending
      scope: "src/core/array_calculator/tests/core.rs"
      issues:
        - "12 always-true assertions (is_ok || is_err)"
        - "~30 ignored results (let _ =)"
      mandate: |
        100% COVERAGE - NO SKIP, NO FAKE, NO CHEATING
        Replace ALL weak assertions with real value verification.
        Every test must assert specific expected values.
      deliverables:
        - "0 instances of assert!(result.is_ok() || result.is_err())"
        - "0 instances of let _ = calculator.calculate_all()"
        - "Every test verifies actual calculated values"

    agent_2_financial_tests:
      status: pending
      scope: "src/core/array_calculator/tests/financial.rs"
      issues:
        - "8 always-true assertions"
        - "~15 ignored results"
      mandate: |
        100% COVERAGE - NO SKIP, NO FAKE, NO CHEATING
        Financial functions are CRITICAL for FP&A.
        Every PMT, NPV, IRR, etc. must have exact value verification.
      deliverables:
        - "0 weak assertions"
        - "Every financial function verified with exact expected values"
        - "Edge cases: zero rate, negative values, boundary periods"

    agent_3_lookup_tests:
      status: pending
      scope: "src/core/array_calculator/tests/lookup.rs"
      issues:
        - "7 always-true assertions"
        - "Missing not-found error tests"
      mandate: |
        100% COVERAGE - NO SKIP, NO FAKE, NO CHEATING
        VLOOKUP, INDEX, MATCH must be 100% tested.
        Include not-found scenarios and error propagation.
      deliverables:
        - "0 weak assertions"
        - "Not-found scenario tests for VLOOKUP, MATCH"
        - "Out-of-bounds INDEX tests"
        - "Empty range handling tests"

    agent_4_aggregation_tests:
      status: pending
      scope: "src/core/array_calculator/tests/aggregation.rs"
      issues:
        - "5 always-true assertions"
      mandate: |
        100% COVERAGE - NO SKIP, NO FAKE, NO CHEATING
        SUM, AVERAGE, COUNT, etc. must be verified with exact values.
      deliverables:
        - "0 weak assertions"
        - "Empty array edge cases"
        - "Single element edge cases"
        - "Large number precision tests"

    agent_5_math_logical_tests:
      status: pending
      scope: "src/core/array_calculator/tests/math.rs + logical.rs + conditional.rs"
      issues:
        - "3 + 5 + 5 = 13 always-true assertions"
        - "~20 ignored results in math.rs"
      mandate: |
        100% COVERAGE - NO SKIP, NO FAKE, NO CHEATING
        Math functions must verify exact precision.
        Logical functions must test all boolean combinations.
      deliverables:
        - "0 weak assertions"
        - "Division by zero tests"
        - "Overflow/underflow tests"
        - "All boolean combination tests"

    agent_6_yaml_fake_fix:
      status: pending
      scope: "tests/e2e_roundtrip_complete.yaml line 55"
      issues:
        - "1 fake formula: =100 (should be INDEX)"
      mandate: |
        100% COVERAGE - NO SKIP, NO FAKE, NO CHEATING
        Replace hardcoded =100 with real INDEX formula.
        Verify roundtrip works with Gnumeric.
      deliverables:
        - "Real INDEX formula replacing =100"
        - "Roundtrip validation passes"

  # ═══════════════════════════════════════════════════════════════════════════
  # PHASE 2: 100% EDGE CASE COVERAGE (6 PARALLEL AGENTS)
  # ═══════════════════════════════════════════════════════════════════════════

  phase_2_edge_case_coverage:
    description: "Achieve 100% edge case coverage for ALL function categories"

    agent_7_text_edge_cases:
      status: pending
      scope: "Text functions: LEN, LEFT, RIGHT, MID, FIND, SUBSTITUTE, etc."
      current_coverage: "14%"
      target_coverage: "100%"
      mandate: |
        100% COVERAGE - NO SKIP, NO FAKE, NO CHEATING
        Text functions must handle ALL edge cases.
      required_tests:
        - "Empty string input for ALL text functions"
        - "Unicode characters (emoji, CJK, RTL)"
        - "Special characters (newlines, tabs, quotes)"
        - "Very long strings (1000+ chars)"
        - "Case sensitivity (UPPER, LOWER, PROPER)"
        - "Position out of bounds (MID, LEFT, RIGHT)"
        - "Not found scenarios (FIND, SEARCH)"
      deliverables:
        - "~25 new edge case tests"
        - "100% text function coverage"
        - "Gnumeric roundtrip validation for all"

    agent_8_lookup_edge_cases:
      status: pending
      scope: "Lookup functions: VLOOKUP, HLOOKUP, INDEX, MATCH, XLOOKUP"
      current_coverage: "43%"
      target_coverage: "100%"
      mandate: |
        100% COVERAGE - NO SKIP, NO FAKE, NO CHEATING
        Lookup functions are critical for data analysis.
      required_tests:
        - "VLOOKUP not found (exact match)"
        - "VLOOKUP approximate match edge cases"
        - "MATCH not found scenarios"
        - "INDEX out of bounds (row/col)"
        - "Empty lookup range"
        - "Single row/column lookups"
        - "Case sensitivity in lookups"
        - "Duplicate value handling"
      deliverables:
        - "~20 new edge case tests"
        - "100% lookup function coverage"
        - "Gnumeric roundtrip validation for all"

    agent_9_financial_edge_cases:
      status: pending
      scope: "Financial functions: PMT, NPV, IRR, XIRR, ACCRINT, DB, DDB, etc."
      current_coverage: "43%"
      target_coverage: "100%"
      mandate: |
        100% COVERAGE - NO SKIP, NO FAKE, NO CHEATING
        Financial functions are THE CORE of FP&A. ZERO tolerance for gaps.
      required_tests:
        - "PMT/PV/FV with zero interest rate"
        - "PMT/PV/FV with negative values"
        - "NPV with all negative cash flows"
        - "IRR no solution scenario"
        - "XIRR with unsorted dates"
        - "XIRR/XNPV date validation errors"
        - "ACCRINT settlement/maturity edge cases"
        - "ACCRINT frequency variations (1,2,4)"
        - "DB/DDB with period > life"
        - "DB/DDB with zero salvage"
        - "EFFECT/NOMINAL with extreme rates"
        - "RATE convergence edge cases"
      deliverables:
        - "~25 new edge case tests"
        - "100% financial function coverage"
        - "Gnumeric roundtrip validation for all"

    agent_10_statistical_edge_cases:
      status: pending
      scope: "Statistical functions: STDEV, VAR, MEDIAN, PERCENTILE, QUARTILE, RANK"
      current_coverage: "50%"
      target_coverage: "100%"
      mandate: |
        100% COVERAGE - NO SKIP, NO FAKE, NO CHEATING
        Statistical accuracy is critical for analysis.
      required_tests:
        - "STDEV/VAR with single element (should error or return 0)"
        - "STDEV/VAR with identical values"
        - "MEDIAN odd vs even count"
        - "PERCENTILE at 0 and 1 boundaries"
        - "PERCENTILE with single element"
        - "QUARTILE all 5 values (0,1,2,3,4)"
        - "RANK with ties"
        - "RANK ascending vs descending"
        - "CORREL with constant values"
        - "CORREL with single pair"
      deliverables:
        - "~15 new edge case tests"
        - "100% statistical function coverage"
        - "Gnumeric roundtrip validation for all"

    agent_11_date_edge_cases:
      status: pending
      scope: "Date functions: DATE, EDATE, EOMONTH, YEAR, MONTH, DAY, etc."
      current_coverage: "75%"
      target_coverage: "100%"
      mandate: |
        100% COVERAGE - NO SKIP, NO FAKE, NO CHEATING
        Date calculations must be exact for financial modeling.
      required_tests:
        - "Leap year Feb 29 handling"
        - "Leap year Feb 28 → Mar 1 transitions"
        - "Month-end 30/31 day handling"
        - "EOMONTH across year boundaries"
        - "EDATE negative months"
        - "DATE with invalid inputs (month 13, day 32)"
        - "Year 1900 leap year bug (Excel compatibility)"
        - "Dates near year 2038 (32-bit limit)"
        - "DAYS between same date (should be 0)"
        - "WEEKDAY all 7 days"
      deliverables:
        - "~15 new edge case tests"
        - "100% date function coverage"
        - "Gnumeric roundtrip validation for all"

    agent_12_error_propagation:
      status: pending
      scope: "Excel error codes: #VALUE!, #REF!, #DIV/0!, #NAME?, #NUM!, #N/A"
      current_coverage: "0%"
      target_coverage: "100%"
      mandate: |
        100% COVERAGE - NO SKIP, NO FAKE, NO CHEATING
        Error propagation must match Excel/Gnumeric behavior exactly.
      required_tests:
        - "#DIV/0! propagation through formulas"
        - "#VALUE! from type mismatches"
        - "#REF! from invalid references"
        - "#NUM! from invalid numeric operations"
        - "#N/A from lookup failures"
        - "IFERROR handling of each error type"
        - "ISERROR detection of each error type"
        - "Error in nested formulas"
        - "Error in array formulas"
      deliverables:
        - "~20 new error propagation tests"
        - "100% error code coverage"
        - "Gnumeric roundtrip validation for all"

  # ═══════════════════════════════════════════════════════════════════════════
  # PHASE 3: VERIFICATION (AUDIT AGENTS)
  # ═══════════════════════════════════════════════════════════════════════════

  phase_3_verification:
    description: "Independent verification of all Phase 1 and Phase 2 work"

    audit_agent_1:
      status: pending
      scope: "Verify Phase 1 agents (1-6)"
      mandate: |
        VERIFY ALL WORK - NO TRUST, ONLY VERIFY
        Re-scan all files fixed by Phase 1 agents.
        Confirm ZERO weak assertions remain.
        Confirm ZERO ignored results remain.
        Report ANY remaining issues.
      deliverables:
        - "Audit report: weak assertions count (must be 0)"
        - "Audit report: ignored results count (must be 0)"
        - "Audit report: any remaining fake tests"

    audit_agent_2:
      status: pending
      scope: "Verify Phase 2 agents (7-12)"
      mandate: |
        VERIFY ALL WORK - NO TRUST, ONLY VERIFY
        Re-scan all edge case tests added by Phase 2 agents.
        Confirm ALL required edge cases are covered.
        Confirm ALL tests use REAL formulas.
        Report ANY gaps or fake tests.
      deliverables:
        - "Audit report: edge case coverage by category"
        - "Audit report: any missing required tests"
        - "Audit report: any fake or weak tests found"

    audit_agent_3:
      status: pending
      scope: "Full roundtrip validation"
      mandate: |
        VERIFY ALL WORK - NO TRUST, ONLY VERIFY
        Run full Gnumeric roundtrip on ALL tests.
        Confirm ALL formulas calculate correctly.
        Report ANY mismatches.
      deliverables:
        - "Roundtrip report: all tests pass"
        - "Roundtrip report: any calculation mismatches"
        - "Final coverage score (must be 10/10)"

  # ═══════════════════════════════════════════════════════════════════════════
  # SUCCESS CRITERIA
  # ═══════════════════════════════════════════════════════════════════════════

  success_criteria:
    - "0 fake formulas (100% real)"
    - "0 weak assertions (100% real verification)"
    - "0 ignored results (100% checked)"
    - "100% text function edge case coverage"
    - "100% lookup function edge case coverage"
    - "100% financial function edge case coverage"
    - "100% statistical function edge case coverage"
    - "100% date function edge case coverage"
    - "100% error propagation coverage"
    - "100% Gnumeric roundtrip pass"
    - "cargo test = ALL PASS"
    - "Audit score: 10/10"

  deliverables:
    phase_1: "Fix 172 weak/fake tests"
    phase_2: "Add ~120 edge case tests"
    phase_3: "Verification audit reports"
    total: "~292 test changes"

  estimated_agents:
    phase_1: 6
    phase_2: 6
    phase_3: 3
    total: 15

# ═══════════════════════════════════════════════════════════════════════════════
# NEXT - FUTURE MILESTONES
# ═══════════════════════════════════════════════════════════════════════════════

next:
  - version: "7.2.1"
    priority: CRITICAL
    status: completed
    summary: "Schema Integrity - Kill Auto-Upgrade, Fix v1.0.0/v5.0.0 Definitions"
    completed: "2025-12-10"
    deliverables:
      - "[DONE] Remove auto-upgrade code from calculate command"
      - "[DONE] Delete forge-demo/examples/cashflow.yaml (used arrays)"
      - "[DONE] Recreate forge-demo GitHub repo with clean history"

  - version: "7.2.4"
    priority: CRITICAL
    status: completed
    summary: "Full Retest - Verify All Tests Pass After Schema/Deps Changes"
    completed: "2025-12-10"
    notes: |
      COMPLETED: All tests verified
      - 814 lib tests passed
      - Integration tests passed
      - No regressions from dependency upgrades
    deliverables:
      - "[DONE] cargo test --lib passes (814 tests)"
      - "[DONE] cargo test --test '*' passes"
      - "[DONE] No regressions confirmed"

  - version: "7.2.9"
    priority: CRITICAL
    status: completed
    summary: "Enterprise Command Gating - Demo Binary Cleanup"
    completed: "2025-12-10"
    notes: |
      COMPLETED: All enterprise commands gated behind #[cfg(feature = "full")]
      Demo now only has 7 commands: calculate, audit, validate, export, import, watch, functions
      Enterprise has 14 commands (all demo + compare, variance, sensitivity, goal-seek, break-even, update, upgrade)
    deliverables:
      - "[DONE] Gate Compare, Variance, Sensitivity, GoalSeek, BreakEven, Update commands"
      - "[DONE] Conditional about/long_about text for demo vs enterprise"
      - "[DONE] Build all 5 platforms (Linux x86_64/ARM64, macOS x86_64/ARM64, Windows)"
      - "[DONE] GitHub release v7.2.9 published"

  - version: "7.2.10"
    priority: NORMAL
    status: completed
    completed: "2025-12-12"
    summary: "Dependency Migration - serde_yaml (deprecated) → serde_yaml_ng"
    rationale: |
      serde_yaml was deprecated by David Tolnay in March 2024.
      Evaluated alternatives:
      - serde_yml: Safe Rust backend (libyml), but docs.rs build fails for 0.0.12
      - serde_yaml_ng: Same unsafe-libyaml backend, 100% API compatible, actively maintained
      Decision: serde_yaml_ng for zero-risk drop-in replacement.
    deliverables:
      - "[DONE] Replace serde_yaml 0.9 with serde_yaml_ng 0.10 in Cargo.toml"
      - "[DONE] Update all imports (9 files)"
      - "[DONE] Full test suite passing (1,258 tests)"
      - "[DONE] Build all 5 platforms"

  - version: "7.2.11"
    priority: NORMAL
    status: pending
    summary: "Remove Update Command - No Public GitHub Repo for Enterprise"
    rationale: |
      The `forge update` command checks github.com/royalbit/forge/releases which is NOT public.
      - forge (enterprise) is self-hosted, never pushed to GitHub
      - forge-demo is public but on a different repo (royalbit/forge-demo)
      - Self-update makes no sense for either binary
      Decision: Disable entirely (Option B) rather than maintain dead code.
    deliverables:
      - "Remove Update command from main.rs (enum variant + match arm)"
      - "Remove src/update.rs module entirely"
      - "Remove update imports from main.rs"
      - "Update --help text (remove update from command list)"
      - "Update README.md installation section"
      - "Create ADR-015: Self-Update Removal Decision"
      - "Delete tests/update_tests.rs"

# ═══════════════════════════════════════════════════════════════════════════════
# MONTE CARLO SIMULATION (CRITICAL - Enterprise Feature)
# ═══════════════════════════════════════════════════════════════════════════════

  - version: "8.0.0"
    priority: CRITICAL
    status: pending
    summary: "Monte Carlo Simulation - Probabilistic FP&A Analysis"
    rationale: |
      Monte Carlo simulation enables probabilistic analysis for FP&A:
      - NPV/IRR uncertainty analysis (most common use case)
      - Revenue/cost forecasting with distributions
      - Risk assessment (VaR, CVaR)
      - Sensitivity analysis via correlation coefficients
      Traditional DCF gives one answer; Monte Carlo gives probability distribution.

      RESEARCH FINDINGS (3-agent parallel research):
      1. Crates: rand_distr (MIT/Apache), statrs (MIT), sobol (BSD) - all permissive
      2. FP&A patterns: Normal, Lognormal, Triangular, PERT, Uniform cover 95% needs
      3. Excel syntax: @RISK/Crystal Ball use Risk*/CB.* prefixes

      Design: MC.* prefix for functions, YAML-native configuration, Latin Hypercube default

    dependencies:
      essential:
        - name: "rand_distr"
          version: "0.5"
          license: "MIT OR Apache-2.0"
          features: "Normal, Lognormal, Triangular, PERT, Uniform distributions"
        - name: "statrs"
          version: "0.18"
          license: "MIT"
          features: "PDF/CDF calculations, statistical functions"
      optional:
        - name: "sobol"
          version: "0.2"
          license: "BSD"
          features: "Quasi-Monte Carlo for high-dimensional variance reduction"

    distributions:
      tier_1_essential:
        - "MC.Normal(mean, stdev) - Symmetric variability, returns"
        - "MC.Triangular(min, mode, max) - Expert estimates, quick modeling"
        - "MC.Uniform(min, max) - Complete uncertainty with bounds"
        - "MC.PERT(min, mode, max) - Smooth expert estimates, project durations"
      tier_2_important:
        - "MC.Lognormal(mean, stdev) - Stock prices, revenue (non-negative)"
        - "MC.Discrete({value: prob, ...}) - Scenario probabilities"
      tier_3_advanced:
        - "MC.Beta(alpha, beta, min, max) - Flexible bounded"
        - "MC.Exponential(lambda) - Time-to-event"

    syntax_design:
      prefix: "MC"
      rationale: "Short, clear, recognizable to finance professionals"
      formula_examples:
        - "revenue: =MC.Normal(1000000, 150000)"
        - "margin: =MC.Triangular(0.55, 0.65, 0.75)"
        - "duration: =MC.PERT(6, 9, 15)"
      yaml_config: |
        monte_carlo:
          enabled: true
          iterations: 10000
          sampling: latin_hypercube  # Industry default, 5x faster convergence
          seed: 12345  # Reproducibility
          outputs:
            - variable: valuation.npv
              percentiles: [10, 50, 90]
              threshold: "> 0"

    outputs:
      statistics:
        - "Mean, Median, Std Dev, Min, Max"
        - "Percentiles: P5, P10, P25, P50, P75, P90, P95"
        - "Probability thresholds: P(NPV > 0), P(IRR > hurdle)"
      sensitivity:
        - "Spearman rank correlation coefficients"
        - "Tornado diagram data (which inputs drive outputs)"
      visualization:
        - "Histogram bin data for charting"
        - "CDF data for S-curves"

    phases:
      phase_1_core:
        version: "8.0.0"
        summary: "Core Monte Carlo Infrastructure"
        enterprise_gated: true
        deliverables:
          # Dependencies
          - "Add rand_distr 0.5, statrs 0.18 to Cargo.toml"
          # Core Implementation
          - "src/monte_carlo/mod.rs - Module structure (#[cfg(feature = full)])"
          - "src/monte_carlo/distributions.rs - MC.Normal, MC.Triangular, MC.Uniform, MC.PERT"
          - "src/monte_carlo/sampler.rs - Monte Carlo + Latin Hypercube sampling"
          - "src/monte_carlo/engine.rs - Simulation loop with seeding"
          - "src/monte_carlo/config.rs - MonteCarloConfig struct for YAML parsing"
          # CLI
          - "CLI: forge simulate command (enterprise only)"
          - "Update main.rs --help with simulate command"
          - "Gate simulate behind #[cfg(feature = full)]"
          # Tests
          - "Unit tests: Distribution statistical properties (mean, variance)"
          - "Unit tests: Seed reproducibility"
          - "Unit tests: LHS vs pure Monte Carlo convergence"
          # Documentation
          - "ADR-016: Monte Carlo Architecture Decision"
        commit_message: "feat(monte-carlo): Phase 1 - Core infrastructure with distributions"
        git_operations:
          - "git add -A"
          - "git commit"
          - "git push origin main"

      phase_2_outputs:
        version: "8.1.0"
        summary: "Output Statistics & Reporting"
        enterprise_gated: true
        deliverables:
          # Implementation
          - "src/monte_carlo/statistics.rs - Mean, median, std dev, percentiles"
          - "src/monte_carlo/results.rs - SimulationResults struct"
          - "Probability thresholds: P(output > target)"
          - "Histogram bin data generation"
          - "JSON/YAML results output format"
          # CLI
          - "Update simulate command with --output flag"
          - "Update --help with output options"
          # Tests
          - "Unit tests: Statistics calculations"
          - "Unit tests: Percentile accuracy"
          - "E2E tests: Full simulation workflow"
          # Documentation
          - "Update docs/FEATURES.md with Monte Carlo section"
        commit_message: "feat(monte-carlo): Phase 2 - Output statistics and reporting"
        git_operations:
          - "git add -A"
          - "git commit"
          - "git push origin main"

      phase_3_correlation:
        version: "8.2.0"
        summary: "Correlation & Sensitivity Analysis"
        enterprise_gated: true
        deliverables:
          # Implementation
          - "src/monte_carlo/correlation.rs - Correlation matrix handling"
          - "Cholesky decomposition for correlated sampling"
          - "src/monte_carlo/sensitivity.rs - Spearman rank correlations"
          - "Tornado diagram data output"
          # YAML Schema
          - "Update schema with correlations: section"
          # Tests
          - "Unit tests: Cholesky decomposition"
          - "Unit tests: Correlated variable generation"
          - "Unit tests: Sensitivity coefficient accuracy"
          # Documentation
          - "Update docs/EXAMPLES.md with correlation examples"
        commit_message: "feat(monte-carlo): Phase 3 - Correlation and sensitivity analysis"
        git_operations:
          - "git add -A"
          - "git commit"
          - "git push origin main"

      phase_4_advanced:
        version: "8.3.0"
        summary: "Advanced Features, Excel Export & Final Documentation"
        enterprise_gated: true
        deliverables:
          # Additional Distributions
          - "MC.Lognormal distribution"
          - "MC.Discrete distribution"
          # Excel Export
          - "Excel export with simulation results sheet"
          - "Histogram chart in Excel output"
          - "Summary statistics in Excel output"
          # Optimization
          - "Convergence monitoring (auto-stop when stable)"
          # Tests
          - "E2E tests: Excel export roundtrip"
          - "E2E tests: Gnumeric validation of exported formulas"
          - "Performance tests: 10K iterations < 5 seconds"
          # Documentation
          - "Update README.md with Monte Carlo section"
          - "Update docs/INSTALLATION.md with new dependencies"
          - "Update docs/VERSION_HISTORY.md"
          - "Final --help text polish"
        commit_message: "feat(monte-carlo): Phase 4 - Advanced features, Excel export, docs"
        git_operations:
          - "git add -A"
          - "git commit"
          - "git push origin main"

    workflow:
      parallel_agents:
        - "Agent 1: ADR-016 creation"
        - "Agent 2: Documentation updates (README, FEATURES, EXAMPLES)"
        - "Main: Core implementation + tests"
      commit_per_phase: true
      push_per_phase: true

    test_requirements:
      mandate: |
        ╔═══════════════════════════════════════════════════════════════════════════╗
        ║            MONTE CARLO TESTING - STATISTICAL ACCURACY REQUIRED            ║
        ╠═══════════════════════════════════════════════════════════════════════════╣
        ║  1. Distribution tests: Verify mean/variance match theoretical values     ║
        ║  2. Seed tests: Same seed → identical results                             ║
        ║  3. LHS tests: Better convergence than pure Monte Carlo                   ║
        ║  4. Correlation tests: Achieved correlation ≈ specified correlation       ║
        ║  5. Edge cases: Empty arrays, single values, extreme parameters           ║
        ║  6. Performance: 10K iterations in < 5 seconds                            ║
        ╚═══════════════════════════════════════════════════════════════════════════╝
      statistical_tests:
        - "Chi-square goodness-of-fit for distribution shape"
        - "Two-sample K-S test comparing samples to theoretical"
        - "Mean within 2% of theoretical (10K+ samples)"
        - "Variance within 5% of theoretical (10K+ samples)"

  - version: "7.3.0"
    priority: NORMAL
    status: pending
    summary: "INCLUDE Feature - Complete E2E Testing & Roundtrip Validation"
    deliverables:
      - "E2E test: YAML → XLSX → Gnumeric → CSV roundtrip with includes"
      - "E2E test: 3+ level recursive includes (main→level1→level2→level3)"
      - "E2E test: @namespace.field formula evaluation"
      - "E2E test: Circular dependency detection"
      - "Documentation: INCLUDE feature limitations"

# ═══════════════════════════════════════════════════════════════════════════════
# BACKLOG
# ═══════════════════════════════════════════════════════════════════════════════

backlog:
  - "Tornado Diagrams (Sensitivity Visualization) - JSON/CSV for charts (HIGH)"
  - "Scenario Analysis (Discrete Branching) - Base/Bull/Bear cases (HIGH)"
  - "Bootstrap Resampling - Non-parametric confidence intervals (MEDIUM)"
  - "Antithetic Variates - 50% variance reduction (LOW)"
  - "Copulas - Non-linear tail dependencies (LOW)"
  - "Control Variates - Use analytical baselines (LOW)"
  - "Find external FOSS tool to validate Forge-native functions"
  - "Enterprise licensing (when ready to leave CGI)"
  - "MCP server documentation"
  - "Performance benchmarks per function"

# ═══════════════════════════════════════════════════════════════════════════════
# SUMMARY
# ═══════════════════════════════════════════════════════════════════════════════

summary:
  total_functions: 159
  categories: 14
  current_version: "7.2.10"
  next_version: "7.2.11"
  next_major: "8.0.0 - Monte Carlo Simulation"

  test_status:
    unit_tests: 801
    integration_tests: 457
    e2e_roundtrip: 57
    total: 1258
    all_passing: true
    engine: "ssconvert (Gnumeric)"

  completed_today:
    - "v7.2.10: Dependency Migration - serde_yaml → serde_yaml_ng"

  upcoming_critical:
    monte_carlo:
      version: "8.0.0"
      summary: "Monte Carlo Simulation - Probabilistic FP&A Analysis"
      dependencies: "rand_distr (MIT), statrs (MIT), sobol (BSD) - ALL PERMISSIVE"
      distributions: "Normal, Triangular, Uniform, PERT, Lognormal, Discrete"
      features:
        - "NPV/IRR uncertainty analysis"
        - "Latin Hypercube sampling (5x faster)"
        - "Correlation matrix support (Cholesky)"
        - "P10/P50/P90 percentiles"
        - "Sensitivity analysis (tornado diagrams)"

  major_upgrades:
    jsonschema: "0.18 → 0.37.4"
    petgraph: "0.6.5 → 0.8.3"
    colored: "2.2.0 → 3.0.0"
    calamine: "0.31 → 0.32"
    notify: "7.0 → 8.2"
    axum: "0.7.9 → 0.8.7"
    serde_yaml: "0.9.34 (deprecated) → serde_yaml_ng 0.10.0"

  schema_enforcement:
    v1_0_0: "SCALAR ONLY (demo)"
    v5_0_0: "ARRAYS/TABLES (enterprise)"
    validation: "hardcoded JSON schemas + runtime check"
    adr: "ADR-014-schema-versioning.md"
