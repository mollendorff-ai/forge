# Forge Roadmap
# Version: Cargo.toml | History: CHANGELOG.md | Config: project.yaml

# ═══════════════════════════════════════════════════════════════════════════════
# CURRENT - No active milestone
# ═══════════════════════════════════════════════════════════════════════════════

current:
  version: "10.0.0-alpha"
  status: in_progress
  summary: "BSL License + Open Source Release"

# ═══════════════════════════════════════════════════════════════════════════════
# GTM - Go-To-Market Strategy (Dec 29, 2025)
# ═══════════════════════════════════════════════════════════════════════════════

gtm:
  decision: "One product, BSL license, full features"
  rationale: |
    - Source Available (not FOSS) - code visible, auditable
    - Commercial production use requires license
    - Converts to Apache 2.0 after 4 years
    - forge-demo DEPRECATED (one product, not two)
    - Shows full moat: MCP, Monte Carlo, FP&A functions
  adr: "ADR-030-GTM-LICENSING-STRATEGY.md"
  analysis: "docs/MARKET_ANALYSIS.md"

  milestones:
    - version: "10.0.0-alpha"
      priority: CRITICAL
      status: in_progress
      summary: "BSL License + GitHub Public Release"
      tasks:
        - "Add BSL-1.1 LICENSE file"
        - "Update README with license terms"
        - "Add COMMERCIAL_LICENSE.md with pricing tiers"
        - "Add license headers to all source files"
        - "Deprecate forge-demo (archive repo)"
        - "Push to public GitHub"
      acceptance_criteria:
        - "LICENSE file is BSL-1.1"
        - "README explains: free eval, paid production"
        - "forge-demo README redirects to forge"

    - version: "10.0.0"
      priority: HIGH
      status: pending
      summary: "Commercial Infrastructure"
      tasks:
        - "License key generation system"
        - "Customer portal (Stripe integration)"
        - "Usage tracking for Cloud MCP"
        - "Enterprise SSO/SAML support"

    - version: "10.1.0"
      priority: MEDIUM
      status: pending
      summary: "Cloud MCP Launch"
      tasks:
        - "Hosted MCP endpoint"
        - "Usage-based billing"
        - "Auto-scaling infrastructure"
        - "Global edge deployment"

# ═══════════════════════════════════════════════════════════════════════════════
# COMPLETED - v9.9.5
# ═══════════════════════════════════════════════════════════════════════════════

completed:
  - version: "9.9.5"
    status: done
    summary: "Consolidate tests inline (Rust idiom) - COMPLETE (1,295 unit tests inline)"

# ═══════════════════════════════════════════════════════════════════════════════
# NEXT - Candidate milestones (pick one to start)
# ═══════════════════════════════════════════════════════════════════════════════

next:
  # ─────────────────────────────────────────────────────────────────────────────
  # COMPLETED - See CHANGELOG.md for details
  # ─────────────────────────────────────────────────────────────────────────────
  # v9.8.0  - E2E Test Migration
  # v9.8.1  - Cleanup (e2e tests deleted, pedantic linting)
  # v9.9.1  - Monte Carlo Fix (FORGE-MC-001)
  # v9.9.2  - Excel Export for Scalar Models (FORGE-EXPORT-001)
  # v9.9.3  - E2E Test Fixes (FORGE-003, FORGE-004, FORGE-005, FORGE-TRIM)
  # v9.9.4  - 100% Unit Test Coverage (+9 HLOOKUP tests)
  # v9.9.5  - Consolidate tests inline (Rust idiom)
  # v9.9.5+ - Static musl builds (no glibc, fully portable Linux binaries)
  # ─────────────────────────────────────────────────────────────────────────────

  - version: "9.9.5"
    priority: HIGH
    status: done
    summary: "Consolidate tests inline + Static musl builds - COMPLETE"
    notes:
      - "All 1,295 unit tests inline with source (Rust idiom)"
      - "Added .cargo/config.toml for static linking"
      - "Linux binaries: x86_64-unknown-linux-musl, aarch64-unknown-linux-musl"
      - "Verified: 'file' shows 'statically linked' - no glibc dependency"

  - version: "9.9.6"
    priority: HIGH
    status: pending
    summary: "100% Coverage Enforcement (ADR-004/ADR-006 compliance)"
    description: |
      Achieve 100% line coverage by:
      1. Marking untestable code with #[cfg(not(coverage))] (Rust nightly pattern)
      2. Adding tests for testable code gaps
      3. Documenting all exclusions in ADR-006
    tasks:
      - "Phase 1: Add #[cfg(not(coverage))] to untestable functions"
      - "  - api/server.rs: run_api_server, shutdown_signal"
      - "  - mcp/server.rs: run_mcp_server_sync"
      - "  - main.rs, bin/*.rs: all main() functions"
      - "  - cli/commands: prompt_*, open_in_editor, watch_file, serve"
      - "Phase 2: Add missing tests for testable code"
      - "  - cli/commands/export.rs: 63% → 100%"
      - "  - cli/commands/import.rs: 72% → 100%"
      - "  - api/handlers.rs: 76% → 100%"
      - "  - parser/mod.rs: 88% → 100%"
      - "Phase 3: Verify with cargo llvm-cov --cfg coverage --fail-under-lines 100"
    acceptance_criteria:
      - "make coverage passes (100% line coverage after exclusions)"
      - "All exclusions documented in ADR-006"
      - "Zero regression in existing tests"
    adr: "ADR-006-COVERAGE-EXCLUSIONS.md"

# ═══════════════════════════════════════════════════════════════════════════════
# BACKLOG - Future ideas (unscheduled)
# ═══════════════════════════════════════════════════════════════════════════════

backlog:
  # ─────────────────────────────────────────────────────────────────────────────
  # Code Quality - URGENT (added Dec 29, 2025)
  # ─────────────────────────────────────────────────────────────────────────────
  - version: "9.9.7"
    priority: HIGH
    summary: "Pedantic Linting - NO EXCEPTIONS"
    description: |
      Enable full pedantic clippy linting with ZERO allows/exceptions.
      Fix ALL warnings in the codebase - do not suppress them.
    tasks:
      - "Update Cargo.toml: pedantic = deny, nursery = deny, cargo = deny"
      - "Fix all clippy warnings (500+ across codebase)"
      - "Update pre-commit hook to enforce -D warnings"
      - "Remove all #[allow(...)] attributes from code"
      - "Update rustfmt.toml for strict formatting"
    acceptance_criteria:
      - "cargo clippy --all-targets -- -D warnings passes with zero output"
      - "No #[allow(clippy::...)] in codebase (grep returns empty)"
      - "Pre-commit hook enforces pedantic linting"

  # ─────────────────────────────────────────────────────────────────────────────
  # Performance Milestones (moved from next - Dec 28, 2025)
  # ─────────────────────────────────────────────────────────────────────────────
  - version: "10.0.0"
    summary: "Performance - SIMD Vectorization"
    deliverables:
      - "Identify hot paths in Monte Carlo, Bootstrap, matrix operations"
      - "Use packed_simd or std::simd for parallel arithmetic"
      - "Benchmark before/after with criterion"
      - "Target: 2-4x speedup on numeric-heavy workloads"

  - version: "10.1.0"
    summary: "Performance - Multi-threading with Rayon"
    deliverables:
      - "Parallelize Monte Carlo iterations across cores"
      - "Parallelize Bootstrap resampling"
      - "Parallelize independent table calculations"
      - "Target: Near-linear scaling with core count"

  - version: "10.2.0"
    summary: "Performance - GPU Acceleration (CUDA/OpenCL)"
    deliverables:
      - "Evaluate rust-cuda or ocl crate"
      - "Offload Monte Carlo to GPU"
      - "Offload matrix operations to GPU"
      - "Optional feature flag (--features gpu)"
      - "Target: 10-100x for large simulations"

  - version: "10.3.0"
    summary: "Performance - Algorithmic Optimizations"
    deliverables:
      - "Profile all functions with flamegraph"
      - "Identify O(n²) or worse algorithms"
      - "Optimize memory allocations (arena allocators)"
      - "Cache repeated calculations"
      - "Target: 2-10x from algorithmic improvements"

  # ─────────────────────────────────────────────────────────────────────────────
  # DANEEL Integration (moved from next - Dec 28, 2025)
  # ─────────────────────────────────────────────────────────────────────────────
  - version: "10.4.0"
    summary: "Crystal Analysis - N-Dimensional Fractal Visualization for DANEEL"
    adr: "ADR-028-CRYSTAL-ANALYSIS.md"
    origin: "Grok (SuperGrok) + Rex - Dec 21, 2025"
    description: |
      Four Laws as embedded vectors ("Law Crystals") in embedding space.
      Thoughts clustering near Law Crystals = caring emerging, quantifiable.
      PCA/UMAP reduce to 3D for TUI visualization.
    dependencies:
      - "linfa = 0.7 (PCA, dimensionality reduction)"
      - "linfa-reduction = 0.7"
      - "candle-core = 0.3 (local embeddings, no GPU)"
      - "candle-transformers = 0.3 (all-MiniLM-L6-v2)"
      - "qdrant-client = 1.0"

  # ─────────────────────────────────────────────────────────────────────────────
  # Other deferred items
  # ─────────────────────────────────────────────────────────────────────────────
  - version: "9.9.0"
    summary: "Port edge cases from forge-e2e to inline Rust unit tests"
    deliverables:
      - "Port edge cases from ../forge-e2e/tests/ to inline unit tests"
      - "Add tests in appropriate src/ modules (Rust way - #[cfg(test)] mod tests)"
      - "Verify all edge cases pass"
      - "Update test count in --help header"

  - version: "7.3.0"
    summary: "INCLUDE Feature - Complete E2E Testing & Roundtrip Validation"
    deliverables:
      - "E2E test: YAML -> XLSX -> Gnumeric -> CSV roundtrip with includes"
      - "E2E test: 3+ level recursive includes (main->level1->level2->level3)"
      - "E2E test: @namespace.field formula evaluation"
      - "E2E test: Circular dependency detection"
      - "Documentation: INCLUDE feature limitations"

  # ─────────────────────────────────────────────────────────────────────────────
  # Original backlog items
  # ─────────────────────────────────────────────────────────────────────────────
  - "Find external FOSS tool to validate Forge-native functions"
  - "Enterprise licensing (when ready to leave CGI)"
  - "MCP server documentation"
  - "Performance benchmarks per function"
  - "FPGA acceleration for HFT (post-capitalization) - see ADR-026"

# ═══════════════════════════════════════════════════════════════════════════════
# BUGS - Active issues (none currently)
# ═══════════════════════════════════════════════════════════════════════════════

bugs: []
  # All fixed bugs moved to CHANGELOG.md:
  # - FORGE-MC-001 (fixed in 9.9.1) - Monte Carlo formula propagation
  # - FORGE-001 through FORGE-005 (fixed in 9.9.3) - E2E test failures
  # - FORGE-TRIM (fixed in 9.9.3) - TRIM internal spaces

# ═══════════════════════════════════════════════════════════════════════════════
# SUMMARY
# ═══════════════════════════════════════════════════════════════════════════════

summary:
  total_functions: 173
  categories: 15
  unit_tests: 1295
  e2e_tests: 836
  total_tests: 2131
  test_coverage: "100% (173/173 functions)"
  gaps: 0
  history: "See CHANGELOG.md"
  note: "v9.9.5 DONE: Tests inline + static musl builds (no glibc). Unit: 1295, E2E: 836"
