# Forge Roadmap
# Version: Cargo.toml | History: CHANGELOG.md | Config: project.yaml

# ═══════════════════════════════════════════════════════════════════════════════
# CURRENT - No active milestone
# ═══════════════════════════════════════════════════════════════════════════════

current:
  version: "9.9.0"
  status: in_progress
  summary: "Port edge cases from forge-e2e to inline Rust unit tests"

# ═══════════════════════════════════════════════════════════════════════════════
# NEXT - Candidate milestones (pick one to start)
# ═══════════════════════════════════════════════════════════════════════════════

next:
  # v9.8.0 E2E Test Migration - COMPLETED (see CHANGELOG.md)
  # v9.8.1 Cleanup - e2e tests deleted from forge, pedantic linting in Cargo.toml

  # ─────────────────────────────────────────────────────────────────────────────
  # CRITICAL: Monte Carlo Dependent Formula Bug (BLOCKING DANEEL PAPER)
  # ─────────────────────────────────────────────────────────────────────────────

  - version: "9.9.1"
    priority: CRITICAL
    status: pending
    summary: "Monte Carlo Dependent Formula Evaluation"
    source: "daneel-models game-theory-asi-race-mc.yaml"
    bugs:
      - id: "FORGE-MC-001"
        title: "MC simulation doesn't propagate sampled values through dependent formulas"
        severity: CRITICAL
        blocking: "DANEEL paper needs probabilistic confidence intervals"
        current: |
          forge simulate correctly samples MC.* functions:
            outputs.p_sampled: mean=0.60 min=0.41 max=0.79
          But dependent formulas return 0:
            outputs.result: "=outputs.p_sampled * 100" → returns 0.0 (should be ~60)
        expected: |
          Sampled values should propagate through the formula dependency chain.
          outputs.result should have mean=60.0, not 0.0
        repro: |
          cat << 'EOF' > /tmp/test-mc.yaml
          _forge_version: "5.0.0"
          monte_carlo:
            enabled: true
            iterations: 1000
            seed: 42
            outputs:
              - variable: outputs.result
                percentiles: [50]
          outputs:
            p_sampled:
              value: null
              formula: "=MC.Triangular(0.4, 0.6, 0.8)"
            result:
              value: null
              formula: "=outputs.p_sampled * 100"
          EOF
          ~/bin/forge simulate /tmp/test-mc.yaml
        file: "src/cli/commands/simulate.rs or src/monte_carlo/"
        impact: "All Monte Carlo models with dependent calculations are broken"

  # ─────────────────────────────────────────────────────────────────────────────
  # CRITICAL: Excel Compatibility Bugs (found by forge-e2e + Gnumeric validation)
  # ─────────────────────────────────────────────────────────────────────────────

  - version: "9.9.2"
    priority: CRITICAL
    status: pending
    summary: "Excel Compatibility Fixes"
    source: "forge-e2e Gnumeric validation"
    bugs:
      - id: "FORGE-001"
        title: "Boolean equality with numbers"
        severity: HIGH
        current: "TRUE = 1 returns FALSE, FALSE = 0 returns FALSE"
        expected: "TRUE = 1 should return TRUE (Excel behavior)"
        file: "src/eval/comparison.rs or src/eval/operators.rs"
        test: "=IF(TRUE=1, 'yes', 'no') should return 'yes'"

      - id: "FORGE-002"
        title: "String comparison case sensitivity"
        severity: MEDIUM
        current: "'ABC' = 'abc' returns TRUE (case-insensitive)"
        expected: "Should return FALSE (Excel = operator is case-sensitive)"
        file: "src/eval/comparison.rs"
        test: "=IF('ABC'='abc', 1, 0) should return 0"
        note: "EXACT() is case-sensitive, but = should also be case-sensitive"

      - id: "FORGE-003"
        title: "DATEDIF YD mode off-by-one"
        severity: MEDIUM
        current: "DATEDIF(DATE(2024,10,1), DATE(2025,3,15), 'YD') returns 164"
        expected: "Should return 165 (days excluding years)"
        file: "src/functions/date.rs"
        test: "Add edge case tests for YD mode spanning year boundary"

  # ─────────────────────────────────────────────────────────────────────────────
  # Performance Milestones
  # ─────────────────────────────────────────────────────────────────────────────

  - version: "10.0.0"
    priority: NORMAL
    status: pending
    summary: "Performance - SIMD Vectorization"
    deliverables:
      - "Identify hot paths in Monte Carlo, Bootstrap, matrix operations"
      - "Use packed_simd or std::simd for parallel arithmetic"
      - "Benchmark before/after with criterion"
      - "Target: 2-4x speedup on numeric-heavy workloads"

  - version: "10.1.0"
    priority: NORMAL
    status: pending
    summary: "Performance - Multi-threading with Rayon"
    deliverables:
      - "Parallelize Monte Carlo iterations across cores"
      - "Parallelize Bootstrap resampling"
      - "Parallelize independent table calculations"
      - "Target: Near-linear scaling with core count"

  - version: "10.2.0"
    priority: NORMAL
    status: pending
    summary: "Performance - GPU Acceleration (CUDA/OpenCL)"
    deliverables:
      - "Evaluate rust-cuda or ocl crate"
      - "Offload Monte Carlo to GPU"
      - "Offload matrix operations to GPU"
      - "Optional feature flag (--features gpu)"
      - "Target: 10-100x for large simulations"

  - version: "10.3.0"
    priority: NORMAL
    status: pending
    summary: "Performance - Algorithmic Optimizations"
    deliverables:
      - "Profile all functions with flamegraph"
      - "Identify O(n²) or worse algorithms"
      - "Optimize memory allocations (arena allocators)"
      - "Cache repeated calculations"
      - "Target: 2-10x from algorithmic improvements"

  - version: "9.9.0"
    priority: HIGH
    status: pending
    summary: "Port edge cases from forge-e2e to inline Rust unit tests"
    deliverables:
      - "Port edge cases from ../forge-e2e/tests/ to inline unit tests"
      - "Add tests in appropriate src/ modules (Rust way - #[cfg(test)] mod tests)"
      - "Verify all edge cases pass"
      - "Update test count in --help header"

  - version: "7.3.0"
    priority: NORMAL
    status: pending
    summary: "INCLUDE Feature - Complete E2E Testing & Roundtrip Validation"
    deliverables:
      - "E2E test: YAML -> XLSX -> Gnumeric -> CSV roundtrip with includes"
      - "E2E test: 3+ level recursive includes (main->level1->level2->level3)"
      - "E2E test: @namespace.field formula evaluation"
      - "E2E test: Circular dependency detection"
      - "Documentation: INCLUDE feature limitations"

# ═══════════════════════════════════════════════════════════════════════════════
# BACKLOG - Future ideas (unscheduled)
# ═══════════════════════════════════════════════════════════════════════════════

backlog:
  - "Find external FOSS tool to validate Forge-native functions"
  - "Enterprise licensing (when ready to leave CGI)"
  - "MCP server documentation"
  - "Performance benchmarks per function"
  - "FPGA acceleration for HFT (post-capitalization) - see ADR-026"

# ═══════════════════════════════════════════════════════════════════════════════
# BUGS - Active issues
# ═══════════════════════════════════════════════════════════════════════════════

bugs:
  - id: "FORGE-MC-001"
    title: "Monte Carlo dependent formula evaluation broken"
    severity: CRITICAL
    status: open
    blocking: "DANEEL paper probabilistic analysis"
    description: |
      forge simulate samples MC.* functions correctly but doesn't propagate
      sampled values through dependent formulas. All downstream calculations
      return 0.0 instead of computed values.
    reporter: "daneel-models/game-theory-asi-race-mc.yaml"
    date: "2025-12-17"

# BUG-001 through BUG-013 fixed
# BUG-010 to BUG-013 were already resolved by BUG-003 to BUG-009 fixes (Boolean literals, comparisons)
# See CHANGELOG.md for details

# ═══════════════════════════════════════════════════════════════════════════════
# SUMMARY
# ═══════════════════════════════════════════════════════════════════════════════

summary:
  total_functions: 173
  categories: 15
  unit_tests: 1825
  history: "See CHANGELOG.md"
