# Forge Roadmap
# For version history, see CHANGELOG.md
# Last updated: 2025-12-08
#
# ═══════════════════════════════════════════════════════════════════════════════
# CODING STANDARDS
# ═══════════════════════════════════════════════════════════════════════════════
# - Unit tests: Keep with code (Rust way: #[cfg(test)] mod tests in same file)
# - Test coverage: 100% mandatory for all functional code
# - No file > 1,500 lines (split into submodules when exceeded)
# - Zero warnings policy
# - ADR-006: Use #[cfg(not(coverage))] for untestable code paths
# ═══════════════════════════════════════════════════════════════════════════════

metadata:
  current_version: "5.17.0"
  last_updated: "2025-12-09"
  philosophy: "Zero tokens. Zero emissions. $40K-$132K/year saved."

current:
  version: "5.17.0"
  status: complete
  date: "2025-12-09"
  summary: "Function Registry + 100% E2E Validation"
  stats:
    tests: 1747
    warnings: 0
    functions_demo: 36
    functions_enterprise: 159
    coverage: "~90%"
  note: "Function registry created (ADR-013), E2E tests complete for all 36 demo functions"

# ═══════════════════════════════════════════════════════════════════════════════
# NEXT MILESTONES
# ═══════════════════════════════════════════════════════════════════════════════

next:

  # ─────────────────────────────────────────────────────────────────────────────
  # 5.15.0: Binary Split + forge-gh E2E Tests
  # ─────────────────────────────────────────────────────────────────────────────

  - version: "5.15.0"
    summary: "Binary Split - forge-demo vs forge"
    priority: HIGHLY-CRITICAL
    status: complete
    notes: |
      ┌─────────────────────────────────────────────────────────────────────────┐
      │ BINARY SPLIT STRATEGY                                                   │
      ├─────────────────────────────────────────────────────────────────────────┤
      │                                                                         │
      │  forge-demo (THE HOOK)              forge (ENTERPRISE)                  │
      │  ────────────────────────           ────────────────────────            │
      │  - 36 core functions                - 134 functions                     │
      │  - NO financial (NPV, PMT, IRR)     - All financial functions           │
      │  - NO statistical (MEDIAN, VAR)     - All statistical functions         │
      │  - NO API server                    - forge-server (REST API)           │
      │  - NO MCP server                    - forge-mcp (AI integration)        │
      │  - v1.0.0 schema only               - v1-v5 schemas                     │
      │                                                                         │
      │  Published to:                      Distribution:                       │
      │  royalbit.ca/forge/                 Licensed customers only             │
      │                                                                         │
      └─────────────────────────────────────────────────────────────────────────┘

      ┌─────────────────────────────────────────────────────────────────────────┐
      │ DEMO FUNCTIONS (36 total)                                               │
      ├─────────────┬───────┬───────────────────────────────────────────────────┤
      │ Category    │ Count │ Functions                                         │
      ├─────────────┼───────┼───────────────────────────────────────────────────┤
      │ Math        │ 9     │ ABS, SQRT, ROUND, ROUNDUP, ROUNDDOWN, FLOOR,      │
      │             │       │ CEILING, MOD, POWER                               │
      │ Aggregation │ 5     │ SUM, AVERAGE, MIN, MAX, COUNT                     │
      │ Logical     │ 5     │ IF, AND, OR, NOT, IFERROR                         │
      │ Text        │ 8     │ CONCAT, LEFT, RIGHT, MID, LEN, UPPER, LOWER, TRIM │
      │ Date        │ 6     │ TODAY, DATE, YEAR, MONTH, DAY, DATEDIF            │
      │ Lookup      │ 3     │ INDEX, MATCH, CHOOSE                              │
      └─────────────┴───────┴───────────────────────────────────────────────────┘

      forge-gh is in ../  (it's a gh repo)
      the royalbit website with the forge page is in ~/src/sites/royalbit.ca (a git repo in gitolite)

    deliverables:
      # ── PHASE 1: Binary Split (forge) ───────────────────────────────────────
      - task: "Rename default binary from 'forge' to 'forge-demo'"
        status: pending
        details: |
          Cargo.toml changes:
          [[bin]]
          name = "forge-demo"
          path = "src/main.rs"

          [[bin]]
          name = "forge"
          path = "src/main.rs"
          required-features = ["full"]  # Enterprise only

      - task: "Update Makefile - build-demo and build-enterprise targets"
        status: pending
        details: |
          make build-demo        # builds forge-demo (default)
          make build-enterprise  # builds forge, forge-server, forge-mcp
          make build-all         # cross-compile both for all platforms

      - task: "Test binary split - verify forge-demo has 36 functions"
        status: pending

      - task: "Test binary split - verify forge has 134 functions"
        status: pending

      # ── PHASE 2: forge-gh E2E Tests ─────────────────────────────────────────
      - task: "Remove e2e_financial.yaml from forge-gh (enterprise functions)"
        status: pending

      - task: "Update e2e_math.yaml - ensure only demo functions"
        status: pending

      - task: "Update e2e_dates.yaml - remove EDATE, EOMONTH, etc. (enterprise)"
        status: pending

      - task: "Update e2e_logical.yaml - ensure only demo functions"
        status: pending

      - task: "Create e2e_text.yaml - test CONCAT, UPPER, LOWER, etc."
        status: pending

      - task: "Create e2e_lookup.yaml - test INDEX, MATCH, CHOOSE"
        status: pending

      - task: "Update run_e2e.sh - download forge-demo from royalbit.ca"
        status: pending
        details: |
          Changes:
          - Download URL: royalbit.ca/forge/forge-demo-$PLATFORM
          - Verify 36 functions work
          - Clear error messages for enterprise function attempts

      - task: "Run forge-gh E2E tests - verify all pass with forge-demo"
        status: pending

      # ── PHASE 3: Documentation Updates ──────────────────────────────────────
      - task: "Update forge-gh README.md - correct function counts (36 demo)"
        status: pending

      - task: "Update forge-gh docs/FUNCTIONS.md - list exactly 36 demo functions"
        status: pending

      - task: "Update ADR-012 - document binary split"
        status: pending

      # ── PHASE 4: Website Deployment ─────────────────────────────────────────
      - task: "Build forge-demo for linux-x86_64, linux-arm64, macos-x86_64, macos-arm64, windows"
        status: pending

      - task: "Upload binaries to royalbit.ca/forge/"
        status: pending

      - task: "Update royalbit.ca/forge/index.html - download links"
        status: pending

      # ── PHASE 5: Release ────────────────────────────────────────────────────
      - task: "Commit forge source changes"
        status: pending

      - task: "Commit forge-gh updates"
        status: pending

      - task: "Push royalbit.ca changes"
        status: pending

      - task: "Tag release v5.15.0"
        status: pending

  # ─────────────────────────────────────────────────────────────────────────────
  # 5.16.0: GitHub Fresh Start + Public Release + E2E Validation
  # ─────────────────────────────────────────────────────────────────────────────

  - version: "5.16.0"
    summary: "GitHub Fresh Start + Public Release + E2E Validation"
    priority: HIGHLY-CRITICAL
    status: complete
    notes: |
      ┌─────────────────────────────────────────────────────────────────────────┐
      │ COMPLETE RELEASE STRATEGY                                               │
      ├─────────────────────────────────────────────────────────────────────────┤
      │                                                                         │
      │  PHASE 1: GitHub Fresh Start                                            │
      │  ─────────────────────────────                                          │
      │  1. Delete royalbit/forge on GitHub                                     │
      │  2. Recreate as PUBLIC repo with same metadata                          │
      │  3. Fresh git init in forge-gh (clean history)                          │
      │  4. Single clean commit with v5.15.0 state                              │
      │  5. Push to GitHub                                                      │
      │                                                                         │
      │  PHASE 2: Build All Platforms                                           │
      │  ─────────────────────────────                                          │
      │  - forge-demo-macos-arm64                                               │
      │  - forge-demo-macos-x86_64                                              │
      │  - forge-demo-linux-x86_64                                              │
      │  - forge-demo-linux-arm64                                               │
      │  - forge-demo-windows.exe                                               │
      │                                                                         │
      │  PHASE 3: E2E Validation (Black-Box Testing)                            │
      │  ─────────────────────────────────────────────                          │
      │  - Test macos-arm64 binary locally before release                       │
      │  - Run all E2E tests against built binary                               │
      │  - Fix any E2E test failures                                            │
      │                                                                         │
      │  PHASE 4: GitHub Release                                                │
      │  ────────────────────────                                               │
      │  - Create GitHub Release v5.15.0                                        │
      │  - Upload all binaries to release                                       │
      │                                                                         │
      │  PHASE 5: Website Cleanup                                               │
      │  ─────────────────────────                                              │
      │  - DELETE binaries from royalbit.ca/forge/                              │
      │  - Update index.html to link to GitHub releases                         │
      │  - Simpler website, downloads from GitHub                               │
      │                                                                         │
      └─────────────────────────────────────────────────────────────────────────┘

    deliverables:
      # ── PHASE 1: GitHub Fresh Start ────────────────────────────────────────
      - task: "Delete royalbit/forge repo on GitHub"
        status: pending
        details: "gh repo delete royalbit/forge --yes (needs delete_repo scope)"

      - task: "Create new PUBLIC royalbit/forge repo"
        status: pending
        details: |
          gh repo create royalbit/forge --public \
            --description "AI hallucinates numbers. Forge doesn't. YAML-based financial modeling with Excel formula evaluation."

      - task: "Remove .git from forge-gh (clean slate)"
        status: pending

      - task: "Git init with fresh history"
        status: pending

      - task: "Single commit: 'Initial release v5.15.0'"
        status: pending

      - task: "Push to GitHub (origin main)"
        status: pending

      # ── PHASE 2: Build All Platforms ───────────────────────────────────────
      - task: "Build forge-demo-macos-arm64"
        status: pending
        details: "cargo build --release --bin forge-demo --target aarch64-apple-darwin"

      - task: "Build forge-demo-macos-x86_64"
        status: pending
        details: "cargo build --release --bin forge-demo --target x86_64-apple-darwin"

      - task: "Build forge-demo-linux-x86_64"
        status: pending
        details: "cargo build --release --bin forge-demo --target x86_64-unknown-linux-musl"

      - task: "Build forge-demo-linux-arm64"
        status: pending
        details: "cargo build --release --bin forge-demo --target aarch64-unknown-linux-musl"

      - task: "Build forge-demo-windows.exe"
        status: pending
        details: "cargo build --release --bin forge-demo --target x86_64-pc-windows-gnu"

      # ── PHASE 3: E2E Validation ────────────────────────────────────────────
      - task: "Black-box test macos-arm64 binary"
        status: pending
        details: |
          Copy built binary to forge-gh/tests/
          Run: ./tests/run_e2e.sh
          All 5 E2E tests must pass

      - task: "Fix any E2E test failures"
        status: pending
        details: "Update E2E test YAML files if needed based on black-box results"

      # ── PHASE 4: GitHub Release ────────────────────────────────────────────
      - task: "Create GitHub Release v5.15.0"
        status: pending
        details: |
          gh release create v5.15.0 --title "v5.15.0 - Demo Release" \
            --notes "36 Excel-compatible functions for financial modeling"

      - task: "Upload all 5 binaries to release"
        status: pending
        details: "gh release upload v5.15.0 forge-demo-*"

      # ── PHASE 5: Website Cleanup ───────────────────────────────────────────
      - task: "Delete binaries from royalbit.ca/forge/"
        status: pending
        details: "rm html/forge/forge-demo-*"

      - task: "Update royalbit.ca/forge/index.html - link to GitHub releases"
        status: pending
        details: |
          Change download buttons to point to:
          https://github.com/royalbit/forge/releases/latest

      - task: "Commit and push royalbit.ca changes"
        status: pending

  # ─────────────────────────────────────────────────────────────────────────────
  # 5.17.0: Function Registry + 100% E2E Validation
  # ─────────────────────────────────────────────────────────────────────────────

  - version: "5.17.0"
    summary: "Function Registry + 100% E2E Validation"
    priority: CRITICAL
    status: complete
    adr: "ADR-013-FUNCTION-REGISTRY.md"
    notes: |
      ┌─────────────────────────────────────────────────────────────────────────┐
      │ TWO PROBLEMS TO FIX                                                     │
      ├─────────────────────────────────────────────────────────────────────────┤
      │                                                                         │
      │ 1. FUNCTION REGISTRY (counts drift, docs outdated)                      │
      │    - Single source of truth: src/functions/registry.rs                  │
      │    - Auto-generate docs from registry                                   │
      │                                                                         │
      │ 2. E2E VALIDATION (only 18/36 demo functions tested)                    │
      │    - Install Gnumeric/LibreOffice via brew                              │
      │    - Add E2E tests for ALL 36 demo functions                            │
      │    - Validate against spreadsheet apps                                  │
      │    - E2E must pass for forge-demo AND forge (enterprise)                │
      │                                                                         │
      │ Missing E2E tests:                                                      │
      │ - ROUNDUP, ROUNDDOWN, COUNT, AND, OR, NOT                               │
      │ - CONCAT, LEFT, RIGHT, MID, UPPER, LOWER, TRIM                          │
      │ - TODAY, DATE, DATEDIF, INDEX, MATCH                                    │
      │                                                                         │
      └─────────────────────────────────────────────────────────────────────────┘

    deliverables:
      # ── PHASE 1: E2E Test Infrastructure ───────────────────────────────────
      - task: "Install Gnumeric/LibreOffice via brew"
        status: pending

      - task: "Create E2E validation script against spreadsheets"
        status: pending

      # ── PHASE 2: Complete E2E Tests (36 demo functions) ────────────────────
      - task: "Add E2E tests for missing Math: ROUNDUP, ROUNDDOWN"
        status: pending

      - task: "Add E2E tests for missing Aggregation: COUNT"
        status: pending

      - task: "Add E2E tests for missing Logical: AND, OR, NOT"
        status: pending

      - task: "Add E2E tests for missing Text: CONCAT, LEFT, RIGHT, MID, UPPER, LOWER, TRIM"
        status: pending

      - task: "Add E2E tests for missing Date: TODAY, DATE, DATEDIF"
        status: pending

      - task: "Add E2E tests for missing Lookup: INDEX, MATCH"
        status: pending

      # ── PHASE 3: Function Registry ─────────────────────────────────────────
      - task: "Create src/functions/registry.rs with FunctionDef struct"
        status: pending

      - task: "Define all 158 functions in registry"
        status: pending

      - task: "Refactor cli/commands/functions.rs to use registry"
        status: pending

      # ── PHASE 4: Validation & Release ──────────────────────────────────────
      - task: "Run E2E tests for forge-demo (36 functions)"
        status: pending

      - task: "Run E2E tests for forge (158 functions)"
        status: pending

      - task: "Update forge-gh README and docs"
        status: pending

      - task: "Update royalbit.ca website stats"
        status: pending

      - task: "Release v5.17.0"
        status: pending

  # ─────────────────────────────────────────────────────────────────────────────
  # 5.18.0: Documentation Polish
  # ─────────────────────────────────────────────────────────────────────────────

  - version: "5.18.0"
    summary: "Documentation Polish"
    priority: NORMAL
    status: pending

  # ─────────────────────────────────────────────────────────────────────────────
  # 5.19.0: 100% Coverage
  # ─────────────────────────────────────────────────────────────────────────────

  - version: "5.19.0"
    summary: "100% Coverage - Dead Code Removal"
    priority: NORMAL
    status: pending

# ═══════════════════════════════════════════════════════════════════════════════
# BACKLOG
# ═══════════════════════════════════════════════════════════════════════════════

backlog:
  - "Enterprise licensing (when ready to leave CGI)"
  - "Git history cleanup - MIT license removal"
  - "MCP server documentation"
