# Forge Roadmap
# Version: Cargo.toml | History: CHANGELOG.md | Config: project.yaml

# ═══════════════════════════════════════════════════════════════════════════════
# COMPLETED
# ═══════════════════════════════════════════════════════════════════════════════

completed:
  - version: "5.15.0"
    date: "2025-12-08"
    summary: "Binary Split - forge-demo (36 functions) vs forge (enterprise)"

  - version: "5.16.0"
    date: "2025-12-08"
    summary: "GitHub Fresh Start - PUBLIC repo, GitHub Releases, website cleanup"

  - version: "5.17.0"
    date: "2025-12-09"
    summary: "Function Registry (ADR-013) + E2E test coverage"

  - version: "5.18.0"
    date: "2025-12-09"
    summary: "Documentation Polish - Enterprise Due Diligence Ready"

  - version: "5.19.0"
    date: "2025-12-09"
    summary: "Demo Function Expansion - 49 functions (add 7 math + 6 trig)"

  - version: "5.19.1"
    date: "2025-12-09"
    summary: "v1.0.0 Schema Bug Fix - String literals with letters"

  - version: "6.0.0"
    date: "2025-12-09"
    summary: "Comprehensive Function Testing & Validation (PARTIAL)"
    note: "Started category testing - 72/159 functions covered (45%)"
    stats:
      unit_tests: 1175
      e2e_tests: 38
      functions_covered: 72
      functions_total: 159
      coverage_percent: 45

  - version: "6.1.0"
    date: "2025-12-09"
    summary: "Math Functions - 100% E2E Coverage (20 functions)"
    deliverables:
      - "tests/e2e_math_complete.yaml - 90 scalars"
      - "tests/e2e_math_edge_cases.yaml - 79 scalars"

  - version: "6.2.0"
    date: "2025-12-09"
    summary: "Date Functions - 100% E2E Coverage (21 functions)"
    deliverables:
      - "tests/e2e_date_complete.yaml - 47 scalars"

  - version: "6.3.0"
    date: "2025-12-09"
    summary: "Text Functions - 100% E2E Coverage (15 functions)"
    deliverables:
      - "tests/e2e_text_complete.yaml - 18 scalars"

  - version: "6.4.0"
    date: "2025-12-09"
    summary: "Aggregation Functions - 100% E2E Coverage (14 functions)"
    deliverables:
      - "tests/e2e_aggregation_complete.yaml - 32 scalars"

  - version: "6.5.0"
    date: "2025-12-09"
    summary: "Lookup Functions - 100% E2E Coverage (13 functions)"
    deliverables:
      - "tests/e2e_lookup_complete.yaml - 17 scalars"

  - version: "6.6.0"
    date: "2025-12-09"
    summary: "Information Functions - 100% E2E Coverage (13 functions)"
    deliverables:
      - "tests/e2e_info_complete.yaml - 23 scalars"

  - version: "6.7.0"
    date: "2025-12-09"
    summary: "Financial Functions - 100% E2E Coverage (13 functions)"
    deliverables:
      - "tests/e2e_financial_complete.yaml - 23 scalars"

  - version: "6.8.0"
    date: "2025-12-09"
    summary: "Trigonometric Functions - 100% E2E Coverage (9 functions)"
    deliverables:
      - "tests/e2e_trig_complete.yaml - 31 scalars"

  - version: "6.9.0"
    date: "2025-12-09"
    summary: "Logical Functions - 100% E2E Coverage (9 functions)"
    deliverables:
      - "tests/e2e_logical_complete.yaml - 33 scalars"

  - version: "6.10.0"
    date: "2025-12-09"
    summary: "Statistical Functions - 100% E2E Coverage (8 functions)"
    deliverables:
      - "tests/e2e_statistical_complete.yaml - 14 scalars"

  - version: "6.11.0"
    date: "2025-12-09"
    summary: "Conditional Functions - 100% E2E Coverage (8 functions)"
    deliverables:
      - "tests/e2e_conditional_complete.yaml - 18 scalars"

  - version: "6.12.0"
    date: "2025-12-09"
    summary: "Forge Native Functions - 100% E2E Coverage (8 functions)"
    deliverables:
      - "tests/e2e_forge_complete.yaml - 17 scalars"

  - version: "6.13.0"
    date: "2025-12-09"
    summary: "Array Functions - 100% E2E Coverage (5 functions)"
    deliverables:
      - "tests/e2e_array_complete.yaml - 7 scalars"

  - version: "6.14.0"
    date: "2025-12-09"
    summary: "Advanced Functions - 100% E2E Coverage (3 functions)"
    deliverables:
      - "tests/e2e_advanced_complete.yaml - 9 scalars"

  - version: "6.15.0"
    date: "2025-12-09"
    summary: "Import/Export Roundtrip - Complete Validation"
    deliverables:
      - "tests/e2e_roundtrip_complete.yaml - 72 scalars covering all categories"
      - "All 16 E2E YAML files validated (459 total scalars)"

  - version: "7.0.1"
    date: "2025-12-09"
    summary: "FAKE TEST REMEDIATION - Real Test Coverage Restored"
    note: "Discovered 71% fake tests, fixed with table-based real function calls"

  - version: "7.0.2"
    date: "2025-12-09"
    summary: "FP&A ACCURACY HOTFIX - 6 Fake Tests Fixed with REAL Function Calls"
    deliverables:
      - "IRR: =ROUND(IRR(irr_cash_flows.values) * 100, 2) - REAL"
      - "MIRR: =ROUND(MIRR(mirr_cash_flows.values, 0.10, 0.12) * 100, 2) - REAL"
      - "XNPV: =ROUND(XNPV(0.09, xnpv_basic_data.values, xnpv_basic_data.dates), 2) - REAL"
      - "XIRR: =ROUND(XIRR(xirr_basic_data.values, xirr_basic_data.dates) * 100, 2) - REAL"
      - "LAMBDA: =LAMBDA(x, x*x)(5) - REAL"
      - "LET: =LET(x, 10, y, 5, x*x+y) - REAL"
    stats:
      unit_tests: 1777
      e2e_yaml_files: 15
      e2e_formulas: 689
      fake_tests_fixed: 6

  - version: "7.1.0"
    date: "2025-12-10"
    summary: "100% Real Test Coverage - 7-Agent Parallel Execution"
    deliverables:
      - "7 parallel agents covering all 159 functions"
      - "1320 unit tests passed"
      - "49 roundtrip tests passed (8 needed formula_translator fix)"

  - version: "7.1.1"
    date: "2025-12-10"
    summary: "XLSX Roundtrip 100% - Formula Translator Fix + Test Modules"
    deliverables:
      - "Fixed formula_translator.rs - general pattern for table.column refs"
      - "Split e2e_libreoffice_tests.rs into tests/roundtrip/ modules"
      - "57 roundtrip tests passing, 0 failing"
      - "1208 tests passing in cargo test"

# ═══════════════════════════════════════════════════════════════════════════════
# CURRENT - v7.2.0 - 100% TEST INTEGRITY (CRITICAL)
# ═══════════════════════════════════════════════════════════════════════════════

current:
  version: "7.2.0"
  priority: CRITICAL
  status: pending
  summary: "100% TEST INTEGRITY - Zero Fake Tests, Zero Weak Assertions, 100% Edge Cases"
  started: "2025-12-10"

  # ═══════════════════════════════════════════════════════════════════════════
  # GLOBAL MANDATE - APPLIES TO ALL AGENTS
  # ═══════════════════════════════════════════════════════════════════════════

  mandate: |
    ╔═══════════════════════════════════════════════════════════════════════════╗
    ║                    FP&A TOOL - 100% COVERAGE MANDATORY                    ║
    ╠═══════════════════════════════════════════════════════════════════════════╣
    ║  THIS IS A FINANCIAL PLANNING & ANALYSIS TOOL.                            ║
    ║  FINANCIAL CALCULATIONS MUST BE EXACT. NO EXCEPTIONS.                     ║
    ║                                                                           ║
    ║  RULES FOR EVERY AGENT:                                                   ║
    ║  1. 100% COVERAGE - Every function, every edge case, every error path     ║
    ║  2. NO SKIP - Do not skip tests, do not ignore functions                  ║
    ║  3. NO FAKE - No hardcoded values, no simulated results                   ║
    ║  4. NO CHEATING - No assert!(true), no is_ok()||is_err(), no let _ =     ║
    ║  5. REAL VERIFICATION - Every test must verify actual calculated values   ║
    ║  6. ROUNDTRIP VALIDATION - Gnumeric/LibreOffice must confirm accuracy     ║
    ║                                                                           ║
    ║  IF YOU CANNOT TEST A FUNCTION: REPORT IT, DO NOT FAKE IT                 ║
    ╚═══════════════════════════════════════════════════════════════════════════╝

  audit_findings:
    date: "2025-12-10"
    current_score: "8.5/10"
    target_score: "10/10"
    unit_tests: "1,305 total (87% real, 13% weak → must be 100% real)"
    e2e_yaml: "1,231 formulas (99.92% real → must be 100% real)"
    roundtrip: "59 tests (54 enabled, 5 ignored → must be 100% enabled or documented)"
    edge_cases: "7.2/10 → must be 10/10"

  # ═══════════════════════════════════════════════════════════════════════════
  # PHASE 1: FIX ALL FAKE/WEAK TESTS (6 PARALLEL AGENTS)
  # ═══════════════════════════════════════════════════════════════════════════

  phase_1_fix_weak_tests:
    description: "Eliminate ALL weak assertions and fake tests"

    agent_1_core_tests:
      status: pending
      scope: "src/core/array_calculator/tests/core.rs"
      issues:
        - "12 always-true assertions (is_ok || is_err)"
        - "~30 ignored results (let _ =)"
      mandate: |
        100% COVERAGE - NO SKIP, NO FAKE, NO CHEATING
        Replace ALL weak assertions with real value verification.
        Every test must assert specific expected values.
      deliverables:
        - "0 instances of assert!(result.is_ok() || result.is_err())"
        - "0 instances of let _ = calculator.calculate_all()"
        - "Every test verifies actual calculated values"

    agent_2_financial_tests:
      status: pending
      scope: "src/core/array_calculator/tests/financial.rs"
      issues:
        - "8 always-true assertions"
        - "~15 ignored results"
      mandate: |
        100% COVERAGE - NO SKIP, NO FAKE, NO CHEATING
        Financial functions are CRITICAL for FP&A.
        Every PMT, NPV, IRR, etc. must have exact value verification.
      deliverables:
        - "0 weak assertions"
        - "Every financial function verified with exact expected values"
        - "Edge cases: zero rate, negative values, boundary periods"

    agent_3_lookup_tests:
      status: pending
      scope: "src/core/array_calculator/tests/lookup.rs"
      issues:
        - "7 always-true assertions"
        - "Missing not-found error tests"
      mandate: |
        100% COVERAGE - NO SKIP, NO FAKE, NO CHEATING
        VLOOKUP, INDEX, MATCH must be 100% tested.
        Include not-found scenarios and error propagation.
      deliverables:
        - "0 weak assertions"
        - "Not-found scenario tests for VLOOKUP, MATCH"
        - "Out-of-bounds INDEX tests"
        - "Empty range handling tests"

    agent_4_aggregation_tests:
      status: pending
      scope: "src/core/array_calculator/tests/aggregation.rs"
      issues:
        - "5 always-true assertions"
      mandate: |
        100% COVERAGE - NO SKIP, NO FAKE, NO CHEATING
        SUM, AVERAGE, COUNT, etc. must be verified with exact values.
      deliverables:
        - "0 weak assertions"
        - "Empty array edge cases"
        - "Single element edge cases"
        - "Large number precision tests"

    agent_5_math_logical_tests:
      status: pending
      scope: "src/core/array_calculator/tests/math.rs + logical.rs + conditional.rs"
      issues:
        - "3 + 5 + 5 = 13 always-true assertions"
        - "~20 ignored results in math.rs"
      mandate: |
        100% COVERAGE - NO SKIP, NO FAKE, NO CHEATING
        Math functions must verify exact precision.
        Logical functions must test all boolean combinations.
      deliverables:
        - "0 weak assertions"
        - "Division by zero tests"
        - "Overflow/underflow tests"
        - "All boolean combination tests"

    agent_6_yaml_fake_fix:
      status: pending
      scope: "tests/e2e_roundtrip_complete.yaml line 55"
      issues:
        - "1 fake formula: =100 (should be INDEX)"
      mandate: |
        100% COVERAGE - NO SKIP, NO FAKE, NO CHEATING
        Replace hardcoded =100 with real INDEX formula.
        Verify roundtrip works with Gnumeric/LibreOffice.
      deliverables:
        - "Real INDEX formula replacing =100"
        - "Roundtrip validation passes"

  # ═══════════════════════════════════════════════════════════════════════════
  # PHASE 2: 100% EDGE CASE COVERAGE (6 PARALLEL AGENTS)
  # ═══════════════════════════════════════════════════════════════════════════

  phase_2_edge_case_coverage:
    description: "Achieve 100% edge case coverage for ALL function categories"

    agent_7_text_edge_cases:
      status: pending
      scope: "Text functions: LEN, LEFT, RIGHT, MID, FIND, SUBSTITUTE, etc."
      current_coverage: "14%"
      target_coverage: "100%"
      mandate: |
        100% COVERAGE - NO SKIP, NO FAKE, NO CHEATING
        Text functions must handle ALL edge cases.
      required_tests:
        - "Empty string input for ALL text functions"
        - "Unicode characters (emoji, CJK, RTL)"
        - "Special characters (newlines, tabs, quotes)"
        - "Very long strings (1000+ chars)"
        - "Case sensitivity (UPPER, LOWER, PROPER)"
        - "Position out of bounds (MID, LEFT, RIGHT)"
        - "Not found scenarios (FIND, SEARCH)"
      deliverables:
        - "~25 new edge case tests"
        - "100% text function coverage"
        - "Gnumeric roundtrip validation for all"

    agent_8_lookup_edge_cases:
      status: pending
      scope: "Lookup functions: VLOOKUP, HLOOKUP, INDEX, MATCH, XLOOKUP"
      current_coverage: "43%"
      target_coverage: "100%"
      mandate: |
        100% COVERAGE - NO SKIP, NO FAKE, NO CHEATING
        Lookup functions are critical for data analysis.
      required_tests:
        - "VLOOKUP not found (exact match)"
        - "VLOOKUP approximate match edge cases"
        - "MATCH not found scenarios"
        - "INDEX out of bounds (row/col)"
        - "Empty lookup range"
        - "Single row/column lookups"
        - "Case sensitivity in lookups"
        - "Duplicate value handling"
      deliverables:
        - "~20 new edge case tests"
        - "100% lookup function coverage"
        - "Gnumeric roundtrip validation for all"

    agent_9_financial_edge_cases:
      status: pending
      scope: "Financial functions: PMT, NPV, IRR, XIRR, ACCRINT, DB, DDB, etc."
      current_coverage: "43%"
      target_coverage: "100%"
      mandate: |
        100% COVERAGE - NO SKIP, NO FAKE, NO CHEATING
        Financial functions are THE CORE of FP&A. ZERO tolerance for gaps.
      required_tests:
        - "PMT/PV/FV with zero interest rate"
        - "PMT/PV/FV with negative values"
        - "NPV with all negative cash flows"
        - "IRR no solution scenario"
        - "XIRR with unsorted dates"
        - "XIRR/XNPV date validation errors"
        - "ACCRINT settlement/maturity edge cases"
        - "ACCRINT frequency variations (1,2,4)"
        - "DB/DDB with period > life"
        - "DB/DDB with zero salvage"
        - "EFFECT/NOMINAL with extreme rates"
        - "RATE convergence edge cases"
      deliverables:
        - "~25 new edge case tests"
        - "100% financial function coverage"
        - "Gnumeric roundtrip validation for all"

    agent_10_statistical_edge_cases:
      status: pending
      scope: "Statistical functions: STDEV, VAR, MEDIAN, PERCENTILE, QUARTILE, RANK"
      current_coverage: "50%"
      target_coverage: "100%"
      mandate: |
        100% COVERAGE - NO SKIP, NO FAKE, NO CHEATING
        Statistical accuracy is critical for analysis.
      required_tests:
        - "STDEV/VAR with single element (should error or return 0)"
        - "STDEV/VAR with identical values"
        - "MEDIAN odd vs even count"
        - "PERCENTILE at 0 and 1 boundaries"
        - "PERCENTILE with single element"
        - "QUARTILE all 5 values (0,1,2,3,4)"
        - "RANK with ties"
        - "RANK ascending vs descending"
        - "CORREL with constant values"
        - "CORREL with single pair"
      deliverables:
        - "~15 new edge case tests"
        - "100% statistical function coverage"
        - "Gnumeric roundtrip validation for all"

    agent_11_date_edge_cases:
      status: pending
      scope: "Date functions: DATE, EDATE, EOMONTH, YEAR, MONTH, DAY, etc."
      current_coverage: "75%"
      target_coverage: "100%"
      mandate: |
        100% COVERAGE - NO SKIP, NO FAKE, NO CHEATING
        Date calculations must be exact for financial modeling.
      required_tests:
        - "Leap year Feb 29 handling"
        - "Leap year Feb 28 → Mar 1 transitions"
        - "Month-end 30/31 day handling"
        - "EOMONTH across year boundaries"
        - "EDATE negative months"
        - "DATE with invalid inputs (month 13, day 32)"
        - "Year 1900 leap year bug (Excel compatibility)"
        - "Dates near year 2038 (32-bit limit)"
        - "DAYS between same date (should be 0)"
        - "WEEKDAY all 7 days"
      deliverables:
        - "~15 new edge case tests"
        - "100% date function coverage"
        - "Gnumeric roundtrip validation for all"

    agent_12_error_propagation:
      status: pending
      scope: "Excel error codes: #VALUE!, #REF!, #DIV/0!, #NAME?, #NUM!, #N/A"
      current_coverage: "0%"
      target_coverage: "100%"
      mandate: |
        100% COVERAGE - NO SKIP, NO FAKE, NO CHEATING
        Error propagation must match Excel/Gnumeric behavior exactly.
      required_tests:
        - "#DIV/0! propagation through formulas"
        - "#VALUE! from type mismatches"
        - "#REF! from invalid references"
        - "#NUM! from invalid numeric operations"
        - "#N/A from lookup failures"
        - "IFERROR handling of each error type"
        - "ISERROR detection of each error type"
        - "Error in nested formulas"
        - "Error in array formulas"
      deliverables:
        - "~20 new error propagation tests"
        - "100% error code coverage"
        - "Gnumeric roundtrip validation for all"

  # ═══════════════════════════════════════════════════════════════════════════
  # PHASE 3: VERIFICATION (AUDIT AGENTS)
  # ═══════════════════════════════════════════════════════════════════════════

  phase_3_verification:
    description: "Independent verification of all Phase 1 and Phase 2 work"

    audit_agent_1:
      status: pending
      scope: "Verify Phase 1 agents (1-6)"
      mandate: |
        VERIFY ALL WORK - NO TRUST, ONLY VERIFY
        Re-scan all files fixed by Phase 1 agents.
        Confirm ZERO weak assertions remain.
        Confirm ZERO ignored results remain.
        Report ANY remaining issues.
      deliverables:
        - "Audit report: weak assertions count (must be 0)"
        - "Audit report: ignored results count (must be 0)"
        - "Audit report: any remaining fake tests"

    audit_agent_2:
      status: pending
      scope: "Verify Phase 2 agents (7-12)"
      mandate: |
        VERIFY ALL WORK - NO TRUST, ONLY VERIFY
        Re-scan all edge case tests added by Phase 2 agents.
        Confirm ALL required edge cases are covered.
        Confirm ALL tests use REAL formulas.
        Report ANY gaps or fake tests.
      deliverables:
        - "Audit report: edge case coverage by category"
        - "Audit report: any missing required tests"
        - "Audit report: any fake or weak tests found"

    audit_agent_3:
      status: pending
      scope: "Full roundtrip validation"
      mandate: |
        VERIFY ALL WORK - NO TRUST, ONLY VERIFY
        Run full Gnumeric/LibreOffice roundtrip on ALL tests.
        Confirm ALL formulas calculate correctly.
        Report ANY mismatches.
      deliverables:
        - "Roundtrip report: all tests pass"
        - "Roundtrip report: any calculation mismatches"
        - "Final coverage score (must be 10/10)"

  # ═══════════════════════════════════════════════════════════════════════════
  # SUCCESS CRITERIA
  # ═══════════════════════════════════════════════════════════════════════════

  success_criteria:
    - "0 fake formulas (100% real)"
    - "0 weak assertions (100% real verification)"
    - "0 ignored results (100% checked)"
    - "100% text function edge case coverage"
    - "100% lookup function edge case coverage"
    - "100% financial function edge case coverage"
    - "100% statistical function edge case coverage"
    - "100% date function edge case coverage"
    - "100% error propagation coverage"
    - "100% Gnumeric/LibreOffice roundtrip pass"
    - "cargo test = ALL PASS"
    - "Audit score: 10/10"

  deliverables:
    phase_1: "Fix 172 weak/fake tests"
    phase_2: "Add ~120 edge case tests"
    phase_3: "Verification audit reports"
    total: "~292 test changes"

  estimated_agents:
    phase_1: 6
    phase_2: 6
    phase_3: 3
    total: 15

# ═══════════════════════════════════════════════════════════════════════════════
# NEXT - FUTURE MILESTONES
# ═══════════════════════════════════════════════════════════════════════════════

next:
  - version: "7.3.0"
    priority: NORMAL
    status: pending
    summary: "INCLUDE Feature - Complete E2E Testing & Roundtrip Validation"
    deliverables:
      - "E2E test: YAML → XLSX → Gnumeric → CSV roundtrip with includes"
      - "E2E test: 3+ level recursive includes (main→level1→level2→level3)"
      - "E2E test: @namespace.field formula evaluation"
      - "E2E test: Circular dependency detection"
      - "Documentation: INCLUDE feature limitations"

# ═══════════════════════════════════════════════════════════════════════════════
# BACKLOG
# ═══════════════════════════════════════════════════════════════════════════════

backlog:
  - "Find external FOSS tool to validate Forge-native functions"
  - "Enterprise licensing (when ready to leave CGI)"
  - "MCP server documentation"
  - "Performance benchmarks per function"

# ═══════════════════════════════════════════════════════════════════════════════
# SUMMARY
# ═══════════════════════════════════════════════════════════════════════════════

summary:
  total_functions: 159
  categories: 14
  current_version: "7.1.1"
  next_version: "7.2.0"

  test_status:
    unit_tests: 1208
    e2e_yaml_formulas: 1231
    roundtrip_tests: 57
    all_passing: true

  audit_status:
    date: "2025-12-10"
    overall_score: "8.5/10"
    next_target: "9.5/10 after v7.2.0"
